import{a as Bt,s as mt,p as Nt,c as Gt,r as a,b as qt,x as Ut,i as Xt,j as _,d as fe,e as vt,f as Vt,m as Wt,g as Yt,R as $t}from"./react-CqtGvNDh.js";import{W as Zt,R as ht,O as Qt,P as Jt,S as gt,a as we,V as Kt,b as en,B as tn,C as nn,L as rn,c as yt,N as bt,A as on,d as Ye,e as ke,f as sn,U as an,g as wt,h as N,i as cn,T as ln,E as un,H as Pt,j as fn,k as dn,D as pn,l as $e,m as mn,n as vn,o as hn,F as gn,p as yn,q as bn,r as wn,s as Pn,t as Cn,M as En,u as He,v as Ze,w as xn,G as Be,x as jn,y as Pe,z as Mn,I as Qe,J as Sn,K as Rn,Q as Tn,X as On,Y as Je,Z as In,_ as An,$ as kn,a0 as Fn}from"./three-Du-EKITq.js";var Ke=Bt();function Ct(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const Et=e=>e&&e.isOrthographicCamera,_n=e=>e&&e.hasOwnProperty("current"),zn=e=>e!=null&&(typeof e=="string"||typeof e=="number"||e.isColor),se=((e,t)=>typeof window<"u"&&(((e=window.document)==null?void 0:e.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?a.useLayoutEffect:a.useEffect;function Ne(e){const t=a.useRef(e);return se(()=>void(t.current=e),[e]),t}function Dn(){const e=qt(),t=Ut();return a.useMemo(()=>({children:n})=>{const o=!!Xt(e,!0,i=>i.type===a.StrictMode)?a.StrictMode:a.Fragment;return _.jsx(o,{children:_.jsx(t,{children:n})})},[e,t])}function Ln({set:e}){return se(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const Hn=(e=>(e=class extends a.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))();function xt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function $(e){var t;return(t=e.__r3f)==null?void 0:t.root.getState()}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e)||I.boo(e))return e===t;const i=I.obj(e);if(i&&r==="reference")return e===t;const l=I.arr(e);if(l&&n==="reference")return e===t;if((l||i)&&e===t)return!0;let c;for(c in e)if(!(c in t))return!1;if(i&&n==="shallow"&&r==="shallow"){for(c in o?t:e)if(!I.equ(e[c],t[c],{strict:o,objects:"reference"}))return!1}else for(c in o?t:e)if(e[c]!==t[c])return!1;if(I.und(c)){if(l&&e.length===0&&t.length===0||i&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Bn(e){const t={nodes:{},materials:{},meshes:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material),n.isMesh&&!t.meshes[n.name]&&(t.meshes[n.name]=n)}),t}function Nn(e){e.type!=="Scene"&&(e.dispose==null||e.dispose());for(const t in e){const n=e[t];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const jt=["children","key","ref"];function Gn(e){const t={};for(const n in e)jt.includes(n)||(t[n]=e[n]);return t}function pe(e,t,n,r){const o=e;let i=o?.__r3f;return i||(i={root:t,type:n,parent:null,children:[],props:Gn(r),object:o,eventCount:0,handlers:{},isHidden:!1},o&&(o.__r3f=i)),i}function oe(e,t){let n=e[t];if(!t.includes("-"))return{root:e,key:t,target:n};n=e;for(const o of t.split("-")){var r;t=o,e=n,n=(r=n)==null?void 0:r[t]}return{root:e,key:t,target:n}}const et=/-\d+$/;function me(e,t){if(I.str(t.props.attach)){if(et.test(t.props.attach)){const o=t.props.attach.replace(et,""),{root:i,key:l}=oe(e.object,o);Array.isArray(i[l])||(i[l]=[])}const{root:n,key:r}=oe(e.object,t.props.attach);t.previousAttach=n[r],n[r]=t.object}else I.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function ve(e,t){if(I.str(t.props.attach)){const{root:n,key:r}=oe(e.object,t.props.attach),o=t.previousAttach;o===void 0?delete n[r]:n[r]=o}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}const Fe=[...jt,"args","dispose","attach","object","onUpdate","dispose"],tt=new Map;function qn(e){let t=tt.get(e.constructor);try{t||(t=new e.constructor,tt.set(e.constructor,t))}catch{}return t}function Un(e,t){const n={};for(const r in t)if(!Fe.includes(r)&&!I.equ(t[r],e.props[r])){n[r]=t[r];for(const o in t)o.startsWith(`${r}-`)&&(n[o]=t[o])}for(const r in e.props){if(Fe.includes(r)||t.hasOwnProperty(r))continue;const{root:o,key:i}=oe(e.object,r);if(o.constructor&&o.constructor.length===0){const l=qn(o);I.und(l)||(n[i]=l[i])}else n[i]=0}return n}const Xn=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Vn=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function U(e,t){var n;const r=e.__r3f,o=r&&Ct(r).getState(),i=r?.eventCount;for(const c in t){let s=t[c];if(Fe.includes(c))continue;if(r&&Vn.test(c)){typeof s=="function"?r.handlers[c]=s:delete r.handlers[c],r.eventCount=Object.keys(r.handlers).length;continue}if(s===void 0)continue;let{root:m,key:f,target:u}=oe(e,c);if(u instanceof Ye&&s instanceof Ye)u.mask=s.mask;else if(u instanceof ke&&zn(s))u.set(s);else if(u!==null&&typeof u=="object"&&typeof u.set=="function"&&typeof u.copy=="function"&&s!=null&&s.constructor&&u.constructor===s.constructor)u.copy(s);else if(u!==null&&typeof u=="object"&&typeof u.set=="function"&&Array.isArray(s))typeof u.fromArray=="function"?u.fromArray(s):u.set(...s);else if(u!==null&&typeof u=="object"&&typeof u.set=="function"&&typeof s=="number")typeof u.setScalar=="function"?u.setScalar(s):u.set(s);else{var l;m[f]=s,o&&!o.linear&&Xn.includes(f)&&(l=m[f])!=null&&l.isTexture&&m[f].format===sn&&m[f].type===an&&(m[f].colorSpace=yt)}}if(r!=null&&r.parent&&o!=null&&o.internal&&(n=r.object)!=null&&n.isObject3D&&i!==r.eventCount){const c=r.object,s=o.internal.interaction.indexOf(c);s>-1&&o.internal.interaction.splice(s,1),r.eventCount&&c.raycast!==null&&o.internal.interaction.push(c)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&te(r),e}function te(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);const n=(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function Mt(e,t){e.manual||(Et(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const H=e=>e?.isObject3D;function ce(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function St(e,t,n,r){const o=n.get(t);o&&(n.delete(t),n.size===0&&(e.delete(r),o.target.releasePointerCapture(r)))}function Wn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(r=>r!==t),n.initialHits=n.initialHits.filter(r=>r!==t),n.hovered.forEach((r,o)=>{(r.eventObject===t||r.object===t)&&n.hovered.delete(o)}),n.capturedMap.forEach((r,o)=>{St(n.capturedMap,t,r,o)})}function Yn(e){function t(s){const{internal:m}=e.getState(),f=s.offsetX-m.initialClick[0],u=s.offsetY-m.initialClick[1];return Math.round(Math.sqrt(f*f+u*u))}function n(s){return s.filter(m=>["Move","Over","Enter","Out","Leave"].some(f=>{var u;return(u=m.__r3f)==null?void 0:u.handlers["onPointer"+f]}))}function r(s,m){const f=e.getState(),u=new Set,v=[],p=m?m(f.internal.interaction):f.internal.interaction;for(let h=0;h<p.length;h++){const d=$(p[h]);d&&(d.raycaster.camera=void 0)}f.previousRoot||f.events.compute==null||f.events.compute(s,f);function P(h){const d=$(h);if(!d||!d.events.enabled||d.raycaster.camera===null)return[];if(d.raycaster.camera===void 0){var C;d.events.compute==null||d.events.compute(s,d,(C=d.previousRoot)==null?void 0:C.getState()),d.raycaster.camera===void 0&&(d.raycaster.camera=null)}return d.raycaster.camera?d.raycaster.intersectObject(h,!0):[]}let b=p.flatMap(P).sort((h,d)=>{const C=$(h.object),x=$(d.object);return!C||!x?h.distance-d.distance:x.events.priority-C.events.priority||h.distance-d.distance}).filter(h=>{const d=ce(h);return u.has(d)?!1:(u.add(d),!0)});f.events.filter&&(b=f.events.filter(b,f));for(const h of b){let d=h.object;for(;d;){var g;(g=d.__r3f)!=null&&g.eventCount&&v.push({...h,eventObject:d}),d=d.parent}}if("pointerId"in s&&f.internal.capturedMap.has(s.pointerId))for(let h of f.internal.capturedMap.get(s.pointerId).values())u.has(ce(h.intersection))||v.push(h.intersection);return v}function o(s,m,f,u){if(s.length){const v={stopped:!1};for(const p of s){let P=$(p.object);if(P||p.object.traverseAncestors(b=>{const g=$(b);if(g)return P=g,!1}),P){const{raycaster:b,pointer:g,camera:h,internal:d}=P,C=new N(g.x,g.y,0).unproject(h),x=E=>{var M,R;return(M=(R=d.capturedMap.get(E))==null?void 0:R.has(p.eventObject))!=null?M:!1},w=E=>{const M={intersection:p,target:m.target};d.capturedMap.has(E)?d.capturedMap.get(E).set(p.eventObject,M):d.capturedMap.set(E,new Map([[p.eventObject,M]])),m.target.setPointerCapture(E)},y=E=>{const M=d.capturedMap.get(E);M&&St(d.capturedMap,p.eventObject,M,E)};let T={};for(let E in m){let M=m[E];typeof M!="function"&&(T[E]=M)}let j={...p,...T,pointer:g,intersections:s,stopped:v.stopped,delta:f,unprojectedPoint:C,ray:b.ray,camera:h,stopPropagation(){const E="pointerId"in m&&d.capturedMap.get(m.pointerId);if((!E||E.has(p.eventObject))&&(j.stopped=v.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(M=>M.eventObject===p.eventObject))){const M=s.slice(0,s.indexOf(p));i([...M,p])}},target:{hasPointerCapture:x,setPointerCapture:w,releasePointerCapture:y},currentTarget:{hasPointerCapture:x,setPointerCapture:w,releasePointerCapture:y},nativeEvent:m};if(u(j),v.stopped===!0)break}}}return s}function i(s){const{internal:m}=e.getState();for(const f of m.hovered.values())if(!s.length||!s.find(u=>u.object===f.object&&u.index===f.index&&u.instanceId===f.instanceId)){const v=f.eventObject.__r3f;if(m.hovered.delete(ce(f)),v!=null&&v.eventCount){const p=v.handlers,P={...f,intersections:s};p.onPointerOut==null||p.onPointerOut(P),p.onPointerLeave==null||p.onPointerLeave(P)}}}function l(s,m){for(let f=0;f<m.length;f++){const u=m[f].__r3f;u==null||u.handlers.onPointerMissed==null||u.handlers.onPointerMissed(s)}}function c(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>i([]);case"onLostPointerCapture":return m=>{const{internal:f}=e.getState();"pointerId"in m&&f.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{f.capturedMap.has(m.pointerId)&&(f.capturedMap.delete(m.pointerId),i([]))})}}return function(f){const{onPointerMissed:u,internal:v}=e.getState();v.lastEvent.current=f;const p=s==="onPointerMove",P=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",g=r(f,p?n:void 0),h=P?t(f):0;s==="onPointerDown"&&(v.initialClick=[f.offsetX,f.offsetY],v.initialHits=g.map(C=>C.eventObject)),P&&!g.length&&h<=2&&(l(f,v.interaction),u&&u(f)),p&&i(g);function d(C){const x=C.eventObject,w=x.__r3f;if(!(w!=null&&w.eventCount))return;const y=w.handlers;if(p){if(y.onPointerOver||y.onPointerEnter||y.onPointerOut||y.onPointerLeave){const T=ce(C),j=v.hovered.get(T);j?j.stopped&&C.stopPropagation():(v.hovered.set(T,C),y.onPointerOver==null||y.onPointerOver(C),y.onPointerEnter==null||y.onPointerEnter(C))}y.onPointerMove==null||y.onPointerMove(C)}else{const T=y[s];T?(!P||v.initialHits.includes(x))&&(l(f,v.interaction.filter(j=>!v.initialHits.includes(j))),T(C)):P&&v.initialHits.includes(x)&&l(f,v.interaction.filter(j=>!v.initialHits.includes(j)))}}o(g,f,h,d)}}return{handlePointer:c}}const nt=e=>!!(e!=null&&e.render),Ge=a.createContext(null),$n=(e,t)=>{const n=vt((c,s)=>{const m=new N,f=new N,u=new N;function v(h=s().camera,d=f,C=s().size){const{width:x,height:w,top:y,left:T}=C,j=x/w;d.isVector3?u.copy(d):u.set(...d);const E=h.getWorldPosition(m).distanceTo(u);if(Et(h))return{width:x/h.zoom,height:w/h.zoom,top:y,left:T,factor:1,distance:E,aspect:j};{const M=h.fov*Math.PI/180,R=2*Math.tan(M/2)*E,B=R*(x/w);return{width:B,height:R,top:y,left:T,factor:x/B,distance:E,aspect:j}}}let p;const P=h=>c(d=>({performance:{...d.performance,current:h}})),b=new wt;return{set:c,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(h=1)=>e(s(),h),advance:(h,d)=>t(h,d,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new cn,pointer:b,mouse:b,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const h=s();p&&clearTimeout(p),h.performance.current!==h.performance.min&&P(h.performance.min),p=setTimeout(()=>P(s().performance.max),h.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:h=>c(d=>({...d,events:{...d.events,...h}})),setSize:(h,d,C=0,x=0)=>{const w=s().camera,y={width:h,height:d,top:C,left:x};c(T=>({size:y,viewport:{...T.viewport,...v(w,f,y)}}))},setDpr:h=>c(d=>{const C=xt(h);return{viewport:{...d.viewport,dpr:C,initialDpr:d.viewport.initialDpr||C}}}),setFrameloop:(h="always")=>{const d=s().clock;d.stop(),d.elapsedTime=0,h!=="never"&&(d.start(),d.elapsedTime=0),c(()=>({frameloop:h}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:a.createRef(),active:!1,frames:0,priority:0,subscribe:(h,d,C)=>{const x=s().internal;return x.priority=x.priority+(d>0?1:0),x.subscribers.push({ref:h,priority:d,store:C}),x.subscribers=x.subscribers.sort((w,y)=>w.priority-y.priority),()=>{const w=s().internal;w!=null&&w.subscribers&&(w.priority=w.priority-(d>0?1:0),w.subscribers=w.subscribers.filter(y=>y.ref!==h))}}}}}),r=n.getState();let o=r.size,i=r.viewport.dpr,l=r.camera;return n.subscribe(()=>{const{camera:c,size:s,viewport:m,gl:f,set:u}=n.getState();if(s.width!==o.width||s.height!==o.height||m.dpr!==i){o=s,i=m.dpr,Mt(c,s),m.dpr>0&&f.setPixelRatio(m.dpr);const v=typeof HTMLCanvasElement<"u"&&f.domElement instanceof HTMLCanvasElement;f.setSize(s.width,s.height,v)}c!==l&&(l=c,u(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(c)}})))}),n.subscribe(c=>e(c)),n};function qe(){const e=a.useContext(Ge);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function A(e=n=>n,t){return qe()(e,t)}function ne(e,t=0){const n=qe(),r=n.getState().internal.subscribe,o=Ne(e);return se(()=>r(o,t,n),[t,r,n]),null}const rt=new WeakMap,Zn=e=>{var t;return typeof e=="function"&&(e==null||(t=e.prototype)==null?void 0:t.constructor)===e};function Rt(e,t){return function(n,...r){let o;return Zn(n)?(o=rt.get(n),o||(o=new n,rt.set(n,o))):o=n,e&&e(o),Promise.all(r.map(i=>new Promise((l,c)=>o.load(i,s=>{H(s?.scene)&&Object.assign(s,Bn(s.scene)),l(s)},t,s=>c(new Error(`Could not load ${i}: ${s?.message}`))))))}}function X(e,t,n,r){const o=Array.isArray(t)?t:[t],i=mt(Rt(n,r),[e,...o],{equal:I.equ});return Array.isArray(t)?i:i[0]}X.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return Nt(Rt(n),[e,...r])};X.clear=function(e,t){const n=Array.isArray(t)?t:[t];return Gt([e,...n])};function Qn(e){const t=Vt(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:a.version}),t}const Tt=0,ee={},Jn=/^three(?=[A-Z])/,ye=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let Kn=0;const er=e=>typeof e=="function";function Ue(e){if(er(e)){const t=`${Kn++}`;return ee[t]=e,t}else Object.assign(ee,e)}function Ot(e,t){const n=ye(e),r=ee[n];if(e!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function tr(e,t,n){var r;return e=ye(e)in ee?e:e.replace(Jn,""),Ot(e,t),e==="primitive"&&(r=t.object)!=null&&r.__r3f&&delete t.object.__r3f,pe(t.object,n,e,t)}function nr(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?ve(e.parent,e):H(e.object)&&(e.object.visible=!1),e.isHidden=!0,te(e)}}function It(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?me(e.parent,e):H(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,te(e)}}function Xe(e,t,n){const r=t.root.getState();if(!(!e.parent&&e.object!==r.scene)){if(!t.object){var o,i;const l=ee[ye(t.type)];t.object=(o=t.props.object)!=null?o:new l(...(i=t.props.args)!=null?i:[]),t.object.__r3f=t}if(U(t.object,t.props),t.props.attach)me(e,t);else if(H(t.object)&&H(e.object)){const l=e.object.children.indexOf(n?.object);if(n&&l!==-1){const c=e.object.children.indexOf(t.object);if(c!==-1){e.object.children.splice(c,1);const s=c<l?l-1:l;e.object.children.splice(s,0,t.object)}else t.object.parent=e.object,e.object.children.splice(l,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const l of t.children)Xe(t,l);te(t)}}function Ce(e,t){t&&(t.parent=e,e.children.push(t),Xe(e,t))}function ot(e,t,n){if(!t||!n)return;t.parent=e;const r=e.children.indexOf(n);r!==-1?e.children.splice(r,0,t):e.children.push(t),Xe(e,t,n)}function At(e){if(typeof e.dispose=="function"){const t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():Ke.unstable_scheduleCallback(Ke.unstable_IdlePriority,t)}}function _e(e,t,n){if(!t)return;t.parent=null;const r=e.children.indexOf(t);r!==-1&&e.children.splice(r,1),t.props.attach?ve(e,t):H(t.object)&&H(e.object)&&(e.object.remove(t.object),Wn(Ct(t),t.object));const o=t.props.dispose!==null&&n!==!1;for(let i=t.children.length-1;i>=0;i--){const l=t.children[i];_e(t,l,o)}t.children.length=0,delete t.object.__r3f,o&&t.type!=="primitive"&&t.object.type!=="Scene"&&At(t.object),n===void 0&&te(t)}function rr(e,t){for(const n of[e,e.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(t);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=t)}const de=[];function or(){for(const[n]of de){const r=n.parent;if(r){n.props.attach?ve(r,n):H(n.object)&&H(r.object)&&r.object.remove(n.object);for(const o of n.children)o.props.attach?ve(n,o):H(o.object)&&H(n.object)&&n.object.remove(o.object)}n.isHidden&&It(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&At(n.object)}for(const[n,r,o]of de){n.props=r;const i=n.parent;if(i){var e,t;const l=ee[ye(n.type)];n.object=(e=n.props.object)!=null?e:new l(...(t=n.props.args)!=null?t:[]),n.object.__r3f=n,rr(o,n.object),U(n.object,n.props),n.props.attach?me(i,n):H(n.object)&&H(i.object)&&i.object.add(n.object);for(const c of n.children)c.props.attach?me(n,c):H(c.object)&&H(n.object)&&n.object.add(c.object);te(n)}}de.length=0}const Ee=()=>{},st={};let le=Tt;const sr=0,ir=4,he=Qn({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:tr,removeChild:_e,appendChild:Ce,appendInitialChild:Ce,insertBefore:ot,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||Ce(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||_e(n,t)},insertInContainerBefore(e,t,n){const r=e.getState().scene.__r3f;!t||!n||!r||ot(r,t,n)},getRootHostContext:()=>st,getChildHostContext:()=>st,commitUpdate(e,t,n,r,o){var i,l,c;Ot(t,r);let s=!1;if((e.type==="primitive"&&n.object!==r.object||((i=r.args)==null?void 0:i.length)!==((l=n.args)==null?void 0:l.length)||(c=r.args)!=null&&c.some((f,u)=>{var v;return f!==((v=n.args)==null?void 0:v[u])}))&&(s=!0),s)de.push([e,{...r},o]);else{const f=Un(e,r);Object.keys(f).length&&(Object.assign(e.props,f),U(e.object,f))}(o.sibling===null||(o.flags&ir)===sr)&&or()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e?.object,prepareForCommit:()=>null,preparePortalMount:e=>pe(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:nr,unhideInstance:It,createTextInstance:Ee,hideTextInstance:Ee,unhideTextInstance:Ee,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:a.createContext(null),setCurrentUpdatePriority(e){le=e},getCurrentUpdatePriority(){return le},resolveUpdatePriority(){var e;if(le!==Tt)return le;switch(typeof window<"u"&&((e=window.event)==null?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return fe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return fe.ContinuousEventPriority;default:return fe.DefaultEventPriority}},resetFormInstance(){}}),Y=new Map,Z={objects:"shallow",strict:!1};function ar(e,t){if(!t&&typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:r,top:o,left:i}=e.parentElement.getBoundingClientRect();return{width:n,height:r,top:o,left:i}}else if(!t&&typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function cr(e){const t=Y.get(e),n=t?.fiber,r=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,i=r||$n(Le,at),l=n||he.createContainer(i,fe.ConcurrentRoot,null,!1,null,"",o,o,o,null);t||Y.set(e,{fiber:l,store:i});let c,s,m=!1,f=null;return{async configure(u={}){let v;f=new Promise(O=>v=O);let{gl:p,size:P,scene:b,events:g,onCreated:h,shadows:d=!1,linear:C=!1,flat:x=!1,legacy:w=!1,orthographic:y=!1,frameloop:T="always",dpr:j=[1,2],performance:E,raycaster:M,camera:R,onPointerMissed:B}=u,S=i.getState(),k=S.gl;if(!S.gl){const O={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},F=typeof p=="function"?await p(O):p;nt(F)?k=F:k=new Zt({...O,...p}),S.set({gl:k})}let L=S.raycaster;L||S.set({raycaster:L=new ht});const{params:ie,...V}=M||{};if(I.equ(V,L,Z)||U(L,{...V}),I.equ(ie,L.params,Z)||U(L,{params:{...L.params,...ie}}),!S.camera||S.camera===s&&!I.equ(s,R,Z)){s=R;const O=R?.isCamera,F=O?R:y?new Qt(0,0,0,0,.1,1e3):new Jt(75,0,.1,1e3);O||(F.position.z=5,R&&(U(F,R),F.manual||("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(F.manual=!0,F.updateProjectionMatrix())),!S.camera&&!(R!=null&&R.rotation)&&F.lookAt(0,0,0)),S.set({camera:F}),L.camera=F}if(!S.scene){let O;b!=null&&b.isScene?(O=b,pe(O,i,"",{})):(O=new gt,pe(O,i,"",{}),b&&U(O,b)),S.set({scene:O})}g&&!S.events.handlers&&S.set({events:g(i)});const W=ar(e,P);if(I.equ(W,S.size,Z)||S.setSize(W.width,W.height,W.top,W.left),j&&S.viewport.dpr!==xt(j)&&S.setDpr(j),S.frameloop!==T&&S.setFrameloop(T),S.onPointerMissed||S.set({onPointerMissed:B}),E&&!I.equ(E,S.performance,Z)&&S.set(O=>({performance:{...O.performance,...E}})),!S.xr){var q;const O=(z,be)=>{const We=i.getState();We.frameloop!=="never"&&at(z,!0,We,be)},F=()=>{const z=i.getState();z.gl.xr.enabled=z.gl.xr.isPresenting,z.gl.xr.setAnimationLoop(z.gl.xr.isPresenting?O:null),z.gl.xr.isPresenting||Le(z)},G={connect(){const z=i.getState().gl;z.xr.addEventListener("sessionstart",F),z.xr.addEventListener("sessionend",F)},disconnect(){const z=i.getState().gl;z.xr.removeEventListener("sessionstart",F),z.xr.removeEventListener("sessionend",F)}};typeof((q=k.xr)==null?void 0:q.addEventListener)=="function"&&G.connect(),S.set({xr:G})}if(k.shadowMap){const O=k.shadowMap.enabled,F=k.shadowMap.type;if(k.shadowMap.enabled=!!d,I.boo(d))k.shadowMap.type=we;else if(I.str(d)){var ae;const G={basic:tn,percentage:en,soft:we,variance:Kt};k.shadowMap.type=(ae=G[d])!=null?ae:we}else I.obj(d)&&Object.assign(k.shadowMap,d);(O!==k.shadowMap.enabled||F!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}return nn.enabled=!w,m||(k.outputColorSpace=C?rn:yt,k.toneMapping=x?bt:on),S.legacy!==w&&S.set(()=>({legacy:w})),S.linear!==C&&S.set(()=>({linear:C})),S.flat!==x&&S.set(()=>({flat:x})),p&&!I.fun(p)&&!nt(p)&&!I.equ(p,k,Z)&&U(k,p),c=h,m=!0,v(),this},render(u){return!m&&!f&&this.configure(),f.then(()=>{he.updateContainer(_.jsx(lr,{store:i,children:u,onCreated:c,rootElement:e}),l,null,()=>{})}),i},unmount(){kt(e)}}}function lr({store:e,children:t,onCreated:n,rootElement:r}){return se(()=>{const o=e.getState();o.set(i=>({internal:{...i.internal,active:!0}})),n&&n(o),e.getState().events.connected||o.events.connect==null||o.events.connect(r)},[]),_.jsx(Ge.Provider,{value:e,children:t})}function kt(e,t){const n=Y.get(e),r=n?.fiber;if(r){const o=n?.store.getState();o&&(o.internal.active=!1),he.updateContainer(null,r,null,()=>{o&&setTimeout(()=>{try{var i,l,c,s;o.events.disconnect==null||o.events.disconnect(),(i=o.gl)==null||(l=i.renderLists)==null||l.dispose==null||l.dispose(),(c=o.gl)==null||c.forceContextLoss==null||c.forceContextLoss(),(s=o.gl)!=null&&s.xr&&o.xr.disconnect(),Nn(o.scene),Y.delete(e)}catch{}},500)})}}function ur(e,t,n){return _.jsx(fr,{children:e,container:t,state:n})}function fr({state:e={},children:t,container:n}){const{events:r,size:o,...i}=e,l=qe(),[c]=a.useState(()=>new ht),[s]=a.useState(()=>new wt),m=Ne((u,v)=>{let p;if(v.camera&&o){const P=v.camera;p=u.viewport.getCurrentViewport(P,new N,o),P!==u.camera&&Mt(P,o)}return{...u,...v,scene:n,raycaster:c,pointer:s,mouse:s,previousRoot:l,events:{...u.events,...v.events,...r},size:{...u.size,...o},viewport:{...u.viewport,...p},setEvents:P=>v.set(b=>({...b,events:{...b.events,...P}}))}}),f=a.useMemo(()=>{const u=vt((p,P)=>({...i,set:p,get:P})),v=p=>u.setState(P=>m.current(p,P));return v(l.getState()),l.subscribe(v),u},[l,n]);return _.jsx(_.Fragment,{children:he.createPortal(_.jsx(Ge.Provider,{value:f,children:t}),f,null)})}const dr=new Set,pr=new Set,mr=new Set;function xe(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function re(e,t){switch(e){case"before":return xe(dr,t);case"after":return xe(pr,t);case"tail":return xe(mr,t)}}let je,Me;function ze(e,t,n){let r=t.clock.getDelta();t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),je=t.internal.subscribers;for(let o=0;o<je.length;o++)Me=je[o],Me.ref.current(Me.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let ge=!1,De=!1,Se,it,Q;function Ft(e){it=requestAnimationFrame(Ft),ge=!0,Se=0,re("before",e),De=!0;for(const n of Y.values()){var t;Q=n.store.getState(),Q.internal.active&&(Q.frameloop==="always"||Q.internal.frames>0)&&!((t=Q.gl.xr)!=null&&t.isPresenting)&&(Se+=ze(e,Q))}if(De=!1,re("after",e),Se===0)return re("tail",e),ge=!1,cancelAnimationFrame(it)}function Le(e,t=1){var n;if(!e)return Y.forEach(r=>Le(r.store.getState(),t));(n=e.gl.xr)!=null&&n.isPresenting||!e.internal.active||e.frameloop==="never"||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):De?e.internal.frames=2:e.internal.frames=1,ge||(ge=!0,requestAnimationFrame(Ft)))}function at(e,t=!0,n,r){if(t&&re("before",e),n)ze(e,n,r);else for(const o of Y.values())ze(e,o.store.getState());t&&re("after",e)}const Re={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function vr(e){const{handlePointer:t}=Yn(e);return{priority:1,enabled:!0,compute(n,r,o){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(Re).reduce((n,r)=>({...n,[r]:t(r)}),{}),update:()=>{var n;const{events:r,internal:o}=e.getState();(n=o.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{const{set:r,events:o}=e.getState();if(o.disconnect==null||o.disconnect(),r(i=>({events:{...i.events,connected:n}})),o.handlers)for(const i in o.handlers){const l=o.handlers[i],[c,s]=Re[i];n.addEventListener(c,l,{passive:s})}},disconnect:()=>{const{set:n,events:r}=e.getState();if(r.connected){if(r.handlers)for(const o in r.handlers){const i=r.handlers[o],[l]=Re[o];r.connected.removeEventListener(l,i)}n(o=>({events:{...o.events,connected:void 0}}))}}}}function hr({ref:e,children:t,fallback:n,resize:r,style:o,gl:i,events:l=vr,eventSource:c,eventPrefix:s,shadows:m,linear:f,flat:u,legacy:v,orthographic:p,frameloop:P,dpr:b,performance:g,raycaster:h,camera:d,scene:C,onPointerMissed:x,onCreated:w,...y}){a.useMemo(()=>Ue(ln),[]);const T=Dn(),[j,E]=Yt({scroll:!0,debounce:{scroll:50,resize:0},...r}),M=a.useRef(null),R=a.useRef(null);a.useImperativeHandle(e,()=>M.current);const B=Ne(x),[S,k]=a.useState(!1),[L,ie]=a.useState(!1);if(S)throw S;if(L)throw L;const V=a.useRef(null);se(()=>{const q=M.current;if(E.width>0&&E.height>0&&q){V.current||(V.current=cr(q));async function ae(){await V.current.configure({gl:i,scene:C,events:l,shadows:m,linear:f,flat:u,legacy:v,orthographic:p,frameloop:P,dpr:b,performance:g,raycaster:h,camera:d,size:E,onPointerMissed:(...O)=>B.current==null?void 0:B.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(c?_n(c)?c.current:c:R.current),s&&O.setEvents({compute:(F,G)=>{const z=F[s+"X"],be=F[s+"Y"];G.pointer.set(z/G.size.width*2-1,-(be/G.size.height)*2+1),G.raycaster.setFromCamera(G.pointer,G.camera)}}),w?.(O)}}),V.current.render(_.jsx(T,{children:_.jsx(Hn,{set:ie,children:_.jsx(a.Suspense,{fallback:_.jsx(Ln,{set:k}),children:t??null})})}))}ae()}}),a.useEffect(()=>{const q=M.current;if(q)return()=>kt(q)},[]);const W=c?"none":"auto";return _.jsx("div",{ref:R,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...o},...y,children:_.jsx("div",{ref:j,style:{width:"100%",height:"100%"},children:_.jsx("canvas",{ref:M,style:{display:"block"},children:n})})})}function _r(e){return _.jsx(Wt,{children:_.jsx(hr,{...e})})}const _t=a.createContext(null),ct=e=>(e.getAttributes()&2)===2,zr=a.memo(a.forwardRef(({children:e,camera:t,scene:n,resolutionScale:r,enabled:o=!0,renderPriority:i=1,autoClear:l=!0,depthBuffer:c,enableNormalPass:s,stencilBuffer:m,multisampling:f=8,frameBufferType:u=Pt},v)=>{const{gl:p,scene:P,camera:b,size:g}=A(),h=n||P,d=t||b,[C,x,w]=a.useMemo(()=>{const j=new un(p,{depthBuffer:c,stencilBuffer:m,multisampling:f,frameBufferType:u});j.addPass(new fn(h,d));let E=null,M=null;return s&&(M=new dn(h,d),M.enabled=!1,j.addPass(M),r!==void 0&&(E=new pn({normalBuffer:M.texture,resolutionScale:r}),E.enabled=!1,j.addPass(E))),[j,M,E]},[d,p,c,m,f,u,h,s,r]);a.useEffect(()=>C?.setSize(g.width,g.height),[C,g]),ne((j,E)=>{if(o){const M=p.autoClear;p.autoClear=l,m&&!l&&p.clearStencil(),C.render(E),p.autoClear=M}},o?i:0);const y=a.useRef(null);a.useLayoutEffect(()=>{const j=[],E=y.current.__r3f;if(E&&C){const M=E.children;for(let R=0;R<M.length;R++){const B=M[R].object;if(B instanceof $e){const S=[B];if(!ct(B)){let L=null;for(;(L=M[R+1]?.object)instanceof $e&&!ct(L);)S.push(L),R++}const k=new mn(d,...S);j.push(k)}else B instanceof hn&&j.push(B)}for(const R of j)C?.addPass(R);x&&(x.enabled=!0),w&&(w.enabled=!0)}return()=>{for(const M of j)C?.removePass(M);x&&(x.enabled=!1),w&&(w.enabled=!1)}},[C,e,d,x,w]),a.useEffect(()=>{const j=p.toneMapping;return p.toneMapping=bt,()=>{p.toneMapping=j}},[p]);const T=a.useMemo(()=>({composer:C,normalPass:x,downSamplingPass:w,resolutionScale:r,camera:d,scene:h}),[C,x,w,r,d,h]);return a.useImperativeHandle(v,()=>C,[C]),_.jsx(_t.Provider,{value:T,children:_.jsx("group",{ref:y,children:e})})}));let gr=0;const lt=new WeakMap,yr=(e,t)=>function({blendFunction:n=t?.blendFunction,opacity:r=t?.opacity,...o}){let i=lt.get(e);if(!i){const s=`@react-three/postprocessing/${e.name}-${gr++}`;Ue({[s]:e}),lt.set(e,i=s)}const l=A(s=>s.camera),c=$t.useMemo(()=>[...t?.args??[],...o.args??[{...t,...o}]],[JSON.stringify(o)]);return _.jsx(i,{camera:l,"blendMode-blendFunction":n,"blendMode-opacity-value":r,...o,args:c})},Dr=a.forwardRef(function(e,t){const{camera:n,normalPass:r,downSamplingPass:o,resolutionScale:i}=a.useContext(_t),l=a.useMemo(()=>r===null&&o===null?(console.error("Please enable the NormalPass in the EffectComposer in order to use SSAO."),{}):new vn(n,r&&!o?r.texture:null,{blendFunction:21,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,bias:.5,intensity:1,color:void 0,normalDepthBuffer:o?o.texture:null,resolutionScale:i??1,depthAwareUpsampling:!0,...e}),[n,o,r,i]);return _.jsx("primitive",{ref:t,object:l,dispose:null})}),Lr=yr(gn);function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},D.apply(null,arguments)}const Hr=a.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:n="middle",font:r,fontSize:o=1,children:i,characters:l,onSync:c,...s},m)=>{const f=A(({invalidate:P})=>P),[u]=a.useState(()=>new yn),[v,p]=a.useMemo(()=>{const P=[];let b="";return a.Children.forEach(i,g=>{typeof g=="string"||typeof g=="number"?b+=g:P.push(g)}),[P,b]},[i]);return mt(()=>new Promise(P=>bn({font:r,characters:l},P)),["troika-text",r,l]),a.useLayoutEffect(()=>void u.sync(()=>{f(),c&&c(u)})),a.useEffect(()=>()=>u.dispose(),[u]),a.createElement("primitive",D({object:u,ref:m,font:r,text:p,anchorX:t,anchorY:n,fontSize:o,sdfGlyphSize:e},s),v)});function br(e,t,n,r){var o;return o=class extends wn{constructor(i){super({vertexShader:t,fragmentShader:n,...i});for(const l in e)this.uniforms[l]=new Pn(e[l]),Object.defineProperty(this,l,{get(){return this.uniforms[l].value},set(c){this.uniforms[l].value=c}});this.uniforms=Cn.clone(this.uniforms)}},o.key=En.generateUUID(),o}const Te=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function zt(e,t){const n=A(i=>i.gl),r=X(He,Te(e)?Object.values(e):e);return a.useLayoutEffect(()=>{t?.(r)},[t]),a.useEffect(()=>{if("initTexture"in n){let i=[];Array.isArray(r)?i=r:r instanceof Ze?i=[r]:Te(r)&&(i=Object.values(r)),i.forEach(l=>{l instanceof Ze&&n.initTexture(l)})}},[n,r]),a.useMemo(()=>{if(Te(e)){const i={};let l=0;for(const c in e)i[c]=r[l++];return i}else return r},[e,r])}zt.preload=e=>X.preload(He,e);zt.clear=e=>X.clear(He,e);const wr=()=>parseInt(xn.replace(/\D+/g,"")),Pr=wr();let ue=null,Dt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Lt(e=!0,t=!0,n){return r=>{n&&n(r),e&&(ue||(ue=new jn),ue.setDecoderPath(typeof e=="string"?e:Dt),r.setDRACOLoader(ue)),t&&r.setMeshoptDecoder(typeof Pe=="function"?Pe():Pe)}}const Ve=(e,t,n,r)=>X(Be,e,Lt(t,n,r));Ve.preload=(e,t,n,r)=>X.preload(Be,e,Lt(t,n,r));Ve.clear=e=>X.clear(Be,e);Ve.setDecoderPath=e=>{Dt=e};function Cr(e,t,n){const r=A(p=>p.size),o=A(p=>p.viewport),i=typeof e=="number"?e:r.width*o.dpr,l=r.height*o.dpr,c=(typeof e=="number"?n:e)||{},{samples:s=0,depth:m,...f}=c,u=m??c.depthBuffer,v=a.useMemo(()=>{const p=new Mn(i,l,{minFilter:Qe,magFilter:Qe,type:Pt,...f});return u&&(p.depthTexture=new Sn(i,l,Rn)),p.samples=s,p},[]);return a.useLayoutEffect(()=>{v.setSize(i,l),s&&(v.samples=s)},[s,v,i,l]),a.useEffect(()=>()=>v.dispose(),[]),v}const Er=e=>typeof e=="function",xr=a.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,children:r,makeDefault:o,...i},l)=>{const c=A(({set:g})=>g),s=A(({camera:g})=>g),m=A(({size:g})=>g),f=a.useRef(null);a.useImperativeHandle(l,()=>f.current,[]);const u=a.useRef(null),v=Cr(t);a.useLayoutEffect(()=>{i.manual||f.current.updateProjectionMatrix()},[m,i]),a.useLayoutEffect(()=>{f.current.updateProjectionMatrix()}),a.useLayoutEffect(()=>{if(o){const g=s;return c(()=>({camera:f.current})),()=>c(()=>({camera:g}))}},[f,o,c]);let p=0,P=null;const b=Er(r);return ne(g=>{b&&(n===1/0||p<n)&&(u.current.visible=!1,g.gl.setRenderTarget(v),P=g.scene.background,e&&(g.scene.background=e),g.gl.render(g.scene,f.current),g.scene.background=P,g.gl.setRenderTarget(null),u.current.visible=!0,p++)}),a.createElement(a.Fragment,null,a.createElement("orthographicCamera",D({left:m.width/-2,right:m.width/2,top:m.height/2,bottom:m.height/-2,ref:f},i),!b&&r),a.createElement("group",{ref:u},b&&r(v.texture)))}),Br=a.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:o=!0,keyEvents:i=!1,onChange:l,onStart:c,onEnd:s,...m},f)=>{const u=A(y=>y.invalidate),v=A(y=>y.camera),p=A(y=>y.gl),P=A(y=>y.events),b=A(y=>y.setEvents),g=A(y=>y.set),h=A(y=>y.get),d=A(y=>y.performance),C=t||v,x=r||P.connected||p.domElement,w=a.useMemo(()=>new Tn(C),[C]);return ne(()=>{w.enabled&&w.update()},-1),a.useEffect(()=>(i&&w.connect(i===!0?x:i),w.connect(x),()=>void w.dispose()),[i,x,n,w,u]),a.useEffect(()=>{const y=E=>{u(),n&&d.regress(),l&&l(E)},T=E=>{c&&c(E)},j=E=>{s&&s(E)};return w.addEventListener("change",y),w.addEventListener("start",T),w.addEventListener("end",j),()=>{w.removeEventListener("start",T),w.removeEventListener("end",j),w.removeEventListener("change",y)}},[l,c,s,w,u,b]),a.useEffect(()=>{if(e){const y=h().controls;return g({controls:w}),()=>g({controls:y})}},[e,w]),a.createElement("primitive",D({ref:f,object:w,enableDamping:o},m))});function jr({defaultScene:e,defaultCamera:t,renderPriority:n=1}){const{gl:r,scene:o,camera:i}=A();let l;return ne(()=>{l=r.autoClear,n===1&&(r.autoClear=!0,r.render(e,t)),r.autoClear=!1,r.clearDepth(),r.render(o,i),r.autoClear=l},n),a.createElement("group",{onPointerOver:()=>null})}function Mr({children:e,renderPriority:t=1}){const{scene:n,camera:r}=A(),[o]=a.useState(()=>new gt);return a.createElement(a.Fragment,null,ur(a.createElement(a.Fragment,null,e,a.createElement(jr,{defaultScene:n,defaultCamera:r,renderPriority:t})),o,{events:{priority:t+1}}))}const Ht=a.createContext({}),Sr=()=>a.useContext(Ht),Rr=2*Math.PI,Oe=new On,ut=new In,[J,Ie]=[new Je,new Je],ft=new N,dt=new N,Tr=e=>"minPolarAngle"in e,pt=e=>"getTarget"in e,Nr=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:n=1,onUpdate:r,onTarget:o,children:i})=>{const l=A(y=>y.size),c=A(y=>y.camera),s=A(y=>y.controls),m=A(y=>y.invalidate),f=a.useRef(null),u=a.useRef(null),v=a.useRef(!1),p=a.useRef(0),P=a.useRef(new N(0,0,0)),b=a.useRef(new N(0,0,0));a.useEffect(()=>{b.current.copy(c.up),Oe.up.copy(c.up)},[c]);const g=a.useCallback(y=>{v.current=!0,(s||o)&&(P.current=o?.()||(pt(s)?s.getTarget(P.current):s?.target)),p.current=c.position.distanceTo(ft),J.copy(c.quaternion),dt.copy(y).multiplyScalar(p.current).add(ft),Oe.lookAt(dt),Ie.copy(Oe.quaternion),m()},[s,c,o,m]);ne((y,T)=>{if(u.current&&f.current){var j;if(v.current)if(J.angleTo(Ie)<.01)v.current=!1,Tr(s)&&c.up.copy(b.current);else{const E=T*Rr;J.rotateTowards(Ie,E),c.position.set(0,0,1).applyQuaternion(J).multiplyScalar(p.current).add(P.current),c.up.set(0,1,0).applyQuaternion(J).normalize(),c.quaternion.copy(J),pt(s)&&s.setPosition(c.position.x,c.position.y,c.position.z),r?r():s&&s.update(T),m()}ut.copy(c.matrix).invert(),(j=f.current)==null||j.quaternion.setFromRotationMatrix(ut)}});const h=a.useMemo(()=>({tweenCamera:g}),[g]),[d,C]=t,x=e.endsWith("-center")?0:e.endsWith("-left")?-l.width/2+d:l.width/2-d,w=e.startsWith("center-")?0:e.startsWith("top-")?l.height/2-C:-l.height/2+C;return a.createElement(Mr,{renderPriority:n},a.createElement(Ht.Provider,{value:h},a.createElement(xr,{makeDefault:!0,ref:u,position:[0,0,200]}),a.createElement("group",{ref:f,position:[x,w,0]},i)))};function Ae({scale:e=[.8,.05,.05],color:t,rotation:n}){return a.createElement("group",{rotation:n},a.createElement("mesh",{position:[.4,0,0]},a.createElement("boxGeometry",{args:e}),a.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function K({onClick:e,font:t,disabled:n,arcStyle:r,label:o,labelColor:i,axisHeadScale:l=1,...c}){const s=A(b=>b.gl),m=a.useMemo(()=>{const b=document.createElement("canvas");b.width=64,b.height=64;const g=b.getContext("2d");return g.beginPath(),g.arc(32,32,16,0,2*Math.PI),g.closePath(),g.fillStyle=r,g.fill(),o&&(g.font=t,g.textAlign="center",g.fillStyle=i,g.fillText(o,32,41)),new An(b)},[r,o,i,t]),[f,u]=a.useState(!1),v=(o?1:.75)*(f?1.2:1)*l,p=b=>{b.stopPropagation(),u(!0)},P=b=>{b.stopPropagation(),u(!1)};return a.createElement("sprite",D({scale:v,onPointerOver:n?void 0:p,onPointerOut:n?void 0:e||P},c),a.createElement("spriteMaterial",{map:m,"map-anisotropy":s.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:o?1:.75,toneMapped:!1}))}const Gr=({hideNegativeAxes:e,hideAxisHeads:t,disabled:n,font:r="18px Inter var, Arial, sans-serif",axisColors:o=["#ff2060","#20df80","#2080ff"],axisHeadScale:i=1,axisScale:l,labels:c=["X","Y","Z"],labelColor:s="#000",onClick:m,...f})=>{const[u,v,p]=o,{tweenCamera:P}=Sr(),b={font:r,disabled:n,labelColor:s,onClick:m,axisHeadScale:i,onPointerDown:n?void 0:g=>{P(g.object.position),g.stopPropagation()}};return a.createElement("group",D({scale:40},f),a.createElement(Ae,{color:u,rotation:[0,0,0],scale:l}),a.createElement(Ae,{color:v,rotation:[0,0,Math.PI/2],scale:l}),a.createElement(Ae,{color:p,rotation:[0,-Math.PI/2,0],scale:l}),!t&&a.createElement(a.Fragment,null,a.createElement(K,D({arcStyle:u,position:[1,0,0],label:c[0]},b)),a.createElement(K,D({arcStyle:v,position:[0,1,0],label:c[1]},b)),a.createElement(K,D({arcStyle:p,position:[0,0,1],label:c[2]},b)),!e&&a.createElement(a.Fragment,null,a.createElement(K,D({arcStyle:u,position:[-1,0,0]},b)),a.createElement(K,D({arcStyle:v,position:[0,-1,0]},b)),a.createElement(K,D({arcStyle:p,position:[0,0,-1]},b)))))},Or=br({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new ke,sectionColor:new ke,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new N,worldPlanePosition:new N},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${Pr>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),qr=a.forwardRef(({args:e,cellColor:t="#000000",sectionColor:n="#2080ff",cellSize:r=.5,sectionSize:o=1,followCamera:i=!1,infiniteGrid:l=!1,fadeDistance:c=100,fadeStrength:s=1,fadeFrom:m=1,cellThickness:f=.5,sectionThickness:u=1,side:v=Fn,...p},P)=>{Ue({GridMaterial:Or});const b=a.useRef(null);a.useImperativeHandle(P,()=>b.current,[]);const g=new kn,h=new N(0,1,0),d=new N(0,0,0);ne(w=>{g.setFromNormalAndCoplanarPoint(h,d).applyMatrix4(b.current.matrixWorld);const y=b.current.material,T=y.uniforms.worldCamProjPosition,j=y.uniforms.worldPlanePosition;g.projectPoint(w.camera.position,T.value),j.value.set(0,0,0).applyMatrix4(b.current.matrixWorld)});const C={cellSize:r,sectionSize:o,cellColor:t,sectionColor:n,cellThickness:f,sectionThickness:u},x={fadeDistance:c,fadeStrength:s,fadeFrom:m,infiniteGrid:l,followCamera:i};return a.createElement("mesh",D({ref:b,frustumCulled:!1},p),a.createElement("gridMaterial",D({transparent:!0,"extensions-derivatives":!0,side:v},C,x)),a.createElement("planeGeometry",{args:e}))});function Ir(e,t){const n=e+"Geometry";return a.forwardRef(({args:r,children:o,...i},l)=>{const c=a.useRef(null);return a.useImperativeHandle(l,()=>c.current),a.useLayoutEffect(()=>void t?.(c.current)),a.createElement("mesh",D({ref:c},i),a.createElement(n,{attach:"geometry",args:r}),o)})}const Ur=Ir("box");export{Ur as B,_r as C,qr as G,Dr as I,Lr as N,Br as O,Hr as T,zt as a,Ve as b,A as c,zr as d,Nr as e,Gr as f,ne as u};
