import{a as Gt,s as vt,p as Nt,c as qt,r as a,j as A,b as Ut,x as Xt,i as Vt,d as fe,e as ht,f as Wt,m as Yt,g as $t,R as Zt}from"./react-ChHeTJGV.js";import{W as Qt,R as gt,O as Jt,P as Kt,S as bt,a as we,V as en,b as tn,B as nn,C as rn,L as on,c as yt,N as wt,A as sn,d as Pt,e as B,f as $e,g as ke,h as an,U as cn,i as ln,T as un,j as fn,D as dn,M as pn,F as mn,E as vn,H as Ct,k as hn,l as gn,m as bn,n as Ze,o as yn,p as wn,q as Pn,r as Cn,s as En,t as xn,u as jn,v as Mn,w as Sn,x as He,y as Qe,z as Rn,G as Be,I as Tn,J as Pe,K as On,Q as Je,X as In,Y as Fn,Z as kn,_ as An,$ as Ke,a0 as _n,a1 as Dn,a2 as Ln,a3 as zn}from"./three-DhkpGoii.js";var et=Gt();function Et(e){let t=e.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const xt=e=>e&&e.isOrthographicCamera,Hn=e=>e&&e.hasOwnProperty("current"),Bn=e=>e!=null&&(typeof e=="string"||typeof e=="number"||e.isColor),se=((e,t)=>typeof window<"u"&&(((e=window.document)==null?void 0:e.createElement)||((t=window.navigator)==null?void 0:t.product)==="ReactNative"))()?a.useLayoutEffect:a.useEffect;function Ge(e){const t=a.useRef(e);return se(()=>void(t.current=e),[e]),t}function Gn(){const e=Ut(),t=Xt();return a.useMemo(()=>({children:n})=>{const o=!!Vt(e,!0,i=>i.type===a.StrictMode)?a.StrictMode:a.Fragment;return A.jsx(o,{children:A.jsx(t,{children:n})})},[e,t])}function Nn({set:e}){return se(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}const qn=(e=>(e=class extends a.Component{constructor(...n){super(...n),this.state={error:!1}}componentDidCatch(n){this.props.set(n)}render(){return this.state.error?null:this.props.children}},e.getDerivedStateFromError=()=>({error:!0}),e))();function jt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}function $(e){var t;return(t=e.__r3f)==null?void 0:t.root.getState()}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,nul:e=>e===null,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e)||I.boo(e))return e===t;const i=I.obj(e);if(i&&r==="reference")return e===t;const l=I.arr(e);if(l&&n==="reference")return e===t;if((l||i)&&e===t)return!0;let c;for(c in e)if(!(c in t))return!1;if(i&&n==="shallow"&&r==="shallow"){for(c in o?t:e)if(!I.equ(e[c],t[c],{strict:o,objects:"reference"}))return!1}else for(c in o?t:e)if(e[c]!==t[c])return!1;if(I.und(c)){if(l&&e.length===0&&t.length===0||i&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Un(e){const t={nodes:{},materials:{},meshes:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material),n.isMesh&&!t.meshes[n.name]&&(t.meshes[n.name]=n)}),t}function Xn(e){e.type!=="Scene"&&(e.dispose==null||e.dispose());for(const t in e){const n=e[t];n?.type!=="Scene"&&(n==null||n.dispose==null||n.dispose())}}const Mt=["children","key","ref"];function Vn(e){const t={};for(const n in e)Mt.includes(n)||(t[n]=e[n]);return t}function pe(e,t,n,r){const o=e;let i=o?.__r3f;return i||(i={root:t,type:n,parent:null,children:[],props:Vn(r),object:o,eventCount:0,handlers:{},isHidden:!1},o&&(o.__r3f=i)),i}function oe(e,t){let n=e[t];if(!t.includes("-"))return{root:e,key:t,target:n};n=e;for(const o of t.split("-")){var r;t=o,e=n,n=(r=n)==null?void 0:r[t]}return{root:e,key:t,target:n}}const tt=/-\d+$/;function me(e,t){if(I.str(t.props.attach)){if(tt.test(t.props.attach)){const o=t.props.attach.replace(tt,""),{root:i,key:l}=oe(e.object,o);Array.isArray(i[l])||(i[l]=[])}const{root:n,key:r}=oe(e.object,t.props.attach);t.previousAttach=n[r],n[r]=t.object}else I.fun(t.props.attach)&&(t.previousAttach=t.props.attach(e.object,t.object))}function ve(e,t){if(I.str(t.props.attach)){const{root:n,key:r}=oe(e.object,t.props.attach),o=t.previousAttach;o===void 0?delete n[r]:n[r]=o}else t.previousAttach==null||t.previousAttach(e.object,t.object);delete t.previousAttach}const Ae=[...Mt,"args","dispose","attach","object","onUpdate","dispose"],nt=new Map;function Wn(e){let t=nt.get(e.constructor);try{t||(t=new e.constructor,nt.set(e.constructor,t))}catch{}return t}function Yn(e,t){const n={};for(const r in t)if(!Ae.includes(r)&&!I.equ(t[r],e.props[r])){n[r]=t[r];for(const o in t)o.startsWith(`${r}-`)&&(n[o]=t[o])}for(const r in e.props){if(Ae.includes(r)||t.hasOwnProperty(r))continue;const{root:o,key:i}=oe(e.object,r);if(o.constructor&&o.constructor.length===0){const l=Wn(o);I.und(l)||(n[i]=l[i])}else n[i]=0}return n}const $n=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],Zn=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function U(e,t){var n;const r=e.__r3f,o=r&&Et(r).getState(),i=r?.eventCount;for(const c in t){let s=t[c];if(Ae.includes(c))continue;if(r&&Zn.test(c)){typeof s=="function"?r.handlers[c]=s:delete r.handlers[c],r.eventCount=Object.keys(r.handlers).length;continue}if(s===void 0)continue;let{root:m,key:f,target:u}=oe(e,c);if(u instanceof $e&&s instanceof $e)u.mask=s.mask;else if(u instanceof ke&&Bn(s))u.set(s);else if(u!==null&&typeof u=="object"&&typeof u.set=="function"&&typeof u.copy=="function"&&s!=null&&s.constructor&&u.constructor===s.constructor)u.copy(s);else if(u!==null&&typeof u=="object"&&typeof u.set=="function"&&Array.isArray(s))typeof u.fromArray=="function"?u.fromArray(s):u.set(...s);else if(u!==null&&typeof u=="object"&&typeof u.set=="function"&&typeof s=="number")typeof u.setScalar=="function"?u.setScalar(s):u.set(s);else{var l;m[f]=s,o&&!o.linear&&$n.includes(f)&&(l=m[f])!=null&&l.isTexture&&m[f].format===an&&m[f].type===cn&&(m[f].colorSpace=yt)}}if(r!=null&&r.parent&&o!=null&&o.internal&&(n=r.object)!=null&&n.isObject3D&&i!==r.eventCount){const c=r.object,s=o.internal.interaction.indexOf(c);s>-1&&o.internal.interaction.splice(s,1),r.eventCount&&c.raycast!==null&&o.internal.interaction.push(c)}return r&&r.props.attach===void 0&&(r.object.isBufferGeometry?r.props.attach="geometry":r.object.isMaterial&&(r.props.attach="material")),r&&te(r),e}function te(e){var t;if(!e.parent)return;e.props.onUpdate==null||e.props.onUpdate(e.object);const n=(t=e.root)==null||t.getState==null?void 0:t.getState();n&&n.internal.frames===0&&n.invalidate()}function St(e,t){e.manual||(xt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix())}const H=e=>e?.isObject3D;function ce(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Rt(e,t,n,r){const o=n.get(t);o&&(n.delete(t),n.size===0&&(e.delete(r),o.target.releasePointerCapture(r)))}function Qn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(r=>r!==t),n.initialHits=n.initialHits.filter(r=>r!==t),n.hovered.forEach((r,o)=>{(r.eventObject===t||r.object===t)&&n.hovered.delete(o)}),n.capturedMap.forEach((r,o)=>{Rt(n.capturedMap,t,r,o)})}function Jn(e){function t(s){const{internal:m}=e.getState(),f=s.offsetX-m.initialClick[0],u=s.offsetY-m.initialClick[1];return Math.round(Math.sqrt(f*f+u*u))}function n(s){return s.filter(m=>["Move","Over","Enter","Out","Leave"].some(f=>{var u;return(u=m.__r3f)==null?void 0:u.handlers["onPointer"+f]}))}function r(s,m){const f=e.getState(),u=new Set,v=[],p=m?m(f.internal.interaction):f.internal.interaction;for(let h=0;h<p.length;h++){const d=$(p[h]);d&&(d.raycaster.camera=void 0)}f.previousRoot||f.events.compute==null||f.events.compute(s,f);function P(h){const d=$(h);if(!d||!d.events.enabled||d.raycaster.camera===null)return[];if(d.raycaster.camera===void 0){var w;d.events.compute==null||d.events.compute(s,d,(w=d.previousRoot)==null?void 0:w.getState()),d.raycaster.camera===void 0&&(d.raycaster.camera=null)}return d.raycaster.camera?d.raycaster.intersectObject(h,!0):[]}let y=p.flatMap(P).sort((h,d)=>{const w=$(h.object),E=$(d.object);return!w||!E?h.distance-d.distance:E.events.priority-w.events.priority||h.distance-d.distance}).filter(h=>{const d=ce(h);return u.has(d)?!1:(u.add(d),!0)});f.events.filter&&(y=f.events.filter(y,f));for(const h of y){let d=h.object;for(;d;){var g;(g=d.__r3f)!=null&&g.eventCount&&v.push({...h,eventObject:d}),d=d.parent}}if("pointerId"in s&&f.internal.capturedMap.has(s.pointerId))for(let h of f.internal.capturedMap.get(s.pointerId).values())u.has(ce(h.intersection))||v.push(h.intersection);return v}function o(s,m,f,u){if(s.length){const v={stopped:!1};for(const p of s){let P=$(p.object);if(P||p.object.traverseAncestors(y=>{const g=$(y);if(g)return P=g,!1}),P){const{raycaster:y,pointer:g,camera:h,internal:d}=P,w=new B(g.x,g.y,0).unproject(h),E=x=>{var M,R;return(M=(R=d.capturedMap.get(x))==null?void 0:R.has(p.eventObject))!=null?M:!1},C=x=>{const M={intersection:p,target:m.target};d.capturedMap.has(x)?d.capturedMap.get(x).set(p.eventObject,M):d.capturedMap.set(x,new Map([[p.eventObject,M]])),m.target.setPointerCapture(x)},b=x=>{const M=d.capturedMap.get(x);M&&Rt(d.capturedMap,p.eventObject,M,x)};let T={};for(let x in m){let M=m[x];typeof M!="function"&&(T[x]=M)}let j={...p,...T,pointer:g,intersections:s,stopped:v.stopped,delta:f,unprojectedPoint:w,ray:y.ray,camera:h,stopPropagation(){const x="pointerId"in m&&d.capturedMap.get(m.pointerId);if((!x||x.has(p.eventObject))&&(j.stopped=v.stopped=!0,d.hovered.size&&Array.from(d.hovered.values()).find(M=>M.eventObject===p.eventObject))){const M=s.slice(0,s.indexOf(p));i([...M,p])}},target:{hasPointerCapture:E,setPointerCapture:C,releasePointerCapture:b},currentTarget:{hasPointerCapture:E,setPointerCapture:C,releasePointerCapture:b},nativeEvent:m};if(u(j),v.stopped===!0)break}}}return s}function i(s){const{internal:m}=e.getState();for(const f of m.hovered.values())if(!s.length||!s.find(u=>u.object===f.object&&u.index===f.index&&u.instanceId===f.instanceId)){const v=f.eventObject.__r3f;if(m.hovered.delete(ce(f)),v!=null&&v.eventCount){const p=v.handlers,P={...f,intersections:s};p.onPointerOut==null||p.onPointerOut(P),p.onPointerLeave==null||p.onPointerLeave(P)}}}function l(s,m){for(let f=0;f<m.length;f++){const u=m[f].__r3f;u==null||u.handlers.onPointerMissed==null||u.handlers.onPointerMissed(s)}}function c(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>i([]);case"onLostPointerCapture":return m=>{const{internal:f}=e.getState();"pointerId"in m&&f.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{f.capturedMap.has(m.pointerId)&&(f.capturedMap.delete(m.pointerId),i([]))})}}return function(f){const{onPointerMissed:u,internal:v}=e.getState();v.lastEvent.current=f;const p=s==="onPointerMove",P=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",g=r(f,p?n:void 0),h=P?t(f):0;s==="onPointerDown"&&(v.initialClick=[f.offsetX,f.offsetY],v.initialHits=g.map(w=>w.eventObject)),P&&!g.length&&h<=2&&(l(f,v.interaction),u&&u(f)),p&&i(g);function d(w){const E=w.eventObject,C=E.__r3f;if(!(C!=null&&C.eventCount))return;const b=C.handlers;if(p){if(b.onPointerOver||b.onPointerEnter||b.onPointerOut||b.onPointerLeave){const T=ce(w),j=v.hovered.get(T);j?j.stopped&&w.stopPropagation():(v.hovered.set(T,w),b.onPointerOver==null||b.onPointerOver(w),b.onPointerEnter==null||b.onPointerEnter(w))}b.onPointerMove==null||b.onPointerMove(w)}else{const T=b[s];T?(!P||v.initialHits.includes(E))&&(l(f,v.interaction.filter(j=>!v.initialHits.includes(j))),T(w)):P&&v.initialHits.includes(E)&&l(f,v.interaction.filter(j=>!v.initialHits.includes(j)))}}o(g,f,h,d)}}return{handlePointer:c}}const rt=e=>!!(e!=null&&e.render),Ne=a.createContext(null),Kn=(e,t)=>{const n=ht((c,s)=>{const m=new B,f=new B,u=new B;function v(h=s().camera,d=f,w=s().size){const{width:E,height:C,top:b,left:T}=w,j=E/C;d.isVector3?u.copy(d):u.set(...d);const x=h.getWorldPosition(m).distanceTo(u);if(xt(h))return{width:E/h.zoom,height:C/h.zoom,top:b,left:T,factor:1,distance:x,aspect:j};{const M=h.fov*Math.PI/180,R=2*Math.tan(M/2)*x,G=R*(E/C);return{width:G,height:R,top:b,left:T,factor:E/G,distance:x,aspect:j}}}let p;const P=h=>c(d=>({performance:{...d.performance,current:h}})),y=new Pt;return{set:c,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(h=1)=>e(s(),h),advance:(h,d)=>t(h,d,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ln,pointer:y,mouse:y,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const h=s();p&&clearTimeout(p),h.performance.current!==h.performance.min&&P(h.performance.min),p=setTimeout(()=>P(s().performance.max),h.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:h=>c(d=>({...d,events:{...d.events,...h}})),setSize:(h,d,w=0,E=0)=>{const C=s().camera,b={width:h,height:d,top:w,left:E};c(T=>({size:b,viewport:{...T.viewport,...v(C,f,b)}}))},setDpr:h=>c(d=>{const w=jt(h);return{viewport:{...d.viewport,dpr:w,initialDpr:d.viewport.initialDpr||w}}}),setFrameloop:(h="always")=>{const d=s().clock;d.stop(),d.elapsedTime=0,h!=="never"&&(d.start(),d.elapsedTime=0),c(()=>({frameloop:h}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:a.createRef(),active:!1,frames:0,priority:0,subscribe:(h,d,w)=>{const E=s().internal;return E.priority=E.priority+(d>0?1:0),E.subscribers.push({ref:h,priority:d,store:w}),E.subscribers=E.subscribers.sort((C,b)=>C.priority-b.priority),()=>{const C=s().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(d>0?1:0),C.subscribers=C.subscribers.filter(b=>b.ref!==h))}}}}}),r=n.getState();let o=r.size,i=r.viewport.dpr,l=r.camera;return n.subscribe(()=>{const{camera:c,size:s,viewport:m,gl:f,set:u}=n.getState();if(s.width!==o.width||s.height!==o.height||m.dpr!==i){o=s,i=m.dpr,St(c,s),m.dpr>0&&f.setPixelRatio(m.dpr);const v=typeof HTMLCanvasElement<"u"&&f.domElement instanceof HTMLCanvasElement;f.setSize(s.width,s.height,v)}c!==l&&(l=c,u(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(c)}})))}),n.subscribe(c=>e(c)),n};function qe(){const e=a.useContext(Ne);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function F(e=n=>n,t){return qe()(e,t)}function ne(e,t=0){const n=qe(),r=n.getState().internal.subscribe,o=Ge(e);return se(()=>r(o,t,n),[t,r,n]),null}const ot=new WeakMap,er=e=>{var t;return typeof e=="function"&&(e==null||(t=e.prototype)==null?void 0:t.constructor)===e};function Tt(e,t){return function(n,...r){let o;return er(n)?(o=ot.get(n),o||(o=new n,ot.set(n,o))):o=n,e&&e(o),Promise.all(r.map(i=>new Promise((l,c)=>o.load(i,s=>{H(s?.scene)&&Object.assign(s,Un(s.scene)),l(s)},t,s=>c(new Error(`Could not load ${i}: ${s?.message}`))))))}}function X(e,t,n,r){const o=Array.isArray(t)?t:[t],i=vt(Tt(n,r),[e,...o],{equal:I.equ});return Array.isArray(t)?i:i[0]}X.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return Nt(Tt(n),[e,...r])};X.clear=function(e,t){const n=Array.isArray(t)?t:[t];return qt([e,...n])};function tr(e){const t=Wt(e);return t.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:a.version}),t}const Ot=0,ee={},nr=/^three(?=[A-Z])/,be=e=>`${e[0].toUpperCase()}${e.slice(1)}`;let rr=0;const or=e=>typeof e=="function";function Ue(e){if(or(e)){const t=`${rr++}`;return ee[t]=e,t}else Object.assign(ee,e)}function It(e,t){const n=be(e),r=ee[n];if(e!=="primitive"&&!r)throw new Error(`R3F: ${n} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(e==="primitive"&&!t.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(t.args!==void 0&&!Array.isArray(t.args))throw new Error("R3F: The args prop must be an array!")}function sr(e,t,n){var r;return e=be(e)in ee?e:e.replace(nr,""),It(e,t),e==="primitive"&&(r=t.object)!=null&&r.__r3f&&delete t.object.__r3f,pe(t.object,n,e,t)}function ir(e){if(!e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?ve(e.parent,e):H(e.object)&&(e.object.visible=!1),e.isHidden=!0,te(e)}}function Ft(e){if(e.isHidden){var t;e.props.attach&&(t=e.parent)!=null&&t.object?me(e.parent,e):H(e.object)&&e.props.visible!==!1&&(e.object.visible=!0),e.isHidden=!1,te(e)}}function Xe(e,t,n){const r=t.root.getState();if(!(!e.parent&&e.object!==r.scene)){if(!t.object){var o,i;const l=ee[be(t.type)];t.object=(o=t.props.object)!=null?o:new l(...(i=t.props.args)!=null?i:[]),t.object.__r3f=t}if(U(t.object,t.props),t.props.attach)me(e,t);else if(H(t.object)&&H(e.object)){const l=e.object.children.indexOf(n?.object);if(n&&l!==-1){const c=e.object.children.indexOf(t.object);if(c!==-1){e.object.children.splice(c,1);const s=c<l?l-1:l;e.object.children.splice(s,0,t.object)}else t.object.parent=e.object,e.object.children.splice(l,0,t.object),t.object.dispatchEvent({type:"added"}),e.object.dispatchEvent({type:"childadded",child:t.object})}else e.object.add(t.object)}for(const l of t.children)Xe(t,l);te(t)}}function Ce(e,t){t&&(t.parent=e,e.children.push(t),Xe(e,t))}function st(e,t,n){if(!t||!n)return;t.parent=e;const r=e.children.indexOf(n);r!==-1?e.children.splice(r,0,t):e.children.push(t),Xe(e,t,n)}function kt(e){if(typeof e.dispose=="function"){const t=()=>{try{e.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?t():et.unstable_scheduleCallback(et.unstable_IdlePriority,t)}}function _e(e,t,n){if(!t)return;t.parent=null;const r=e.children.indexOf(t);r!==-1&&e.children.splice(r,1),t.props.attach?ve(e,t):H(t.object)&&H(e.object)&&(e.object.remove(t.object),Qn(Et(t),t.object));const o=t.props.dispose!==null&&n!==!1;for(let i=t.children.length-1;i>=0;i--){const l=t.children[i];_e(t,l,o)}t.children.length=0,delete t.object.__r3f,o&&t.type!=="primitive"&&t.object.type!=="Scene"&&kt(t.object),n===void 0&&te(t)}function ar(e,t){for(const n of[e,e.alternate])if(n!==null)if(typeof n.ref=="function"){n.refCleanup==null||n.refCleanup();const r=n.ref(t);typeof r=="function"&&(n.refCleanup=r)}else n.ref&&(n.ref.current=t)}const de=[];function cr(){for(const[n]of de){const r=n.parent;if(r){n.props.attach?ve(r,n):H(n.object)&&H(r.object)&&r.object.remove(n.object);for(const o of n.children)o.props.attach?ve(n,o):H(o.object)&&H(n.object)&&n.object.remove(o.object)}n.isHidden&&Ft(n),n.object.__r3f&&delete n.object.__r3f,n.type!=="primitive"&&kt(n.object)}for(const[n,r,o]of de){n.props=r;const i=n.parent;if(i){var e,t;const l=ee[be(n.type)];n.object=(e=n.props.object)!=null?e:new l(...(t=n.props.args)!=null?t:[]),n.object.__r3f=n,ar(o,n.object),U(n.object,n.props),n.props.attach?me(i,n):H(n.object)&&H(i.object)&&i.object.add(n.object);for(const c of n.children)c.props.attach?me(n,c):H(c.object)&&H(n.object)&&n.object.add(c.object);te(n)}}de.length=0}const Ee=()=>{},it={};let le=Ot;const lr=0,ur=4,he=tr({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:sr,removeChild:_e,appendChild:Ce,appendInitialChild:Ce,insertBefore:st,appendChildToContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||Ce(n,t)},removeChildFromContainer(e,t){const n=e.getState().scene.__r3f;!t||!n||_e(n,t)},insertInContainerBefore(e,t,n){const r=e.getState().scene.__r3f;!t||!n||!r||st(r,t,n)},getRootHostContext:()=>it,getChildHostContext:()=>it,commitUpdate(e,t,n,r,o){var i,l,c;It(t,r);let s=!1;if((e.type==="primitive"&&n.object!==r.object||((i=r.args)==null?void 0:i.length)!==((l=n.args)==null?void 0:l.length)||(c=r.args)!=null&&c.some((f,u)=>{var v;return f!==((v=n.args)==null?void 0:v[u])}))&&(s=!0),s)de.push([e,{...r},o]);else{const f=Yn(e,r);Object.keys(f).length&&(Object.assign(e.props,f),U(e.object,f))}(o.sibling===null||(o.flags&ur)===lr)&&cr()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:e=>e?.object,prepareForCommit:()=>null,preparePortalMount:e=>pe(e.getState().scene,e,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:ir,unhideInstance:Ft,createTextInstance:Ee,hideTextInstance:Ee,unhideTextInstance:Ee,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:a.createContext(null),setCurrentUpdatePriority(e){le=e},getCurrentUpdatePriority(){return le},resolveUpdatePriority(){var e;if(le!==Ot)return le;switch(typeof window<"u"&&((e=window.event)==null?void 0:e.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return fe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return fe.ContinuousEventPriority;default:return fe.DefaultEventPriority}},resetFormInstance(){}}),Y=new Map,Z={objects:"shallow",strict:!1};function fr(e,t){if(!t&&typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:r,top:o,left:i}=e.parentElement.getBoundingClientRect();return{width:n,height:r,top:o,left:i}}else if(!t&&typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...t}}function dr(e){const t=Y.get(e),n=t?.fiber,r=t?.store;t&&console.warn("R3F.createRoot should only be called once!");const o=typeof reportError=="function"?reportError:console.error,i=r||Kn(ze,ct),l=n||he.createContainer(i,fe.ConcurrentRoot,null,!1,null,"",o,o,o,null);t||Y.set(e,{fiber:l,store:i});let c,s,m=!1,f=null;return{async configure(u={}){let v;f=new Promise(O=>v=O);let{gl:p,size:P,scene:y,events:g,onCreated:h,shadows:d=!1,linear:w=!1,flat:E=!1,legacy:C=!1,orthographic:b=!1,frameloop:T="always",dpr:j=[1,2],performance:x,raycaster:M,camera:R,onPointerMissed:G}=u,S=i.getState(),k=S.gl;if(!S.gl){const O={canvas:e,powerPreference:"high-performance",antialias:!0,alpha:!0},_=typeof p=="function"?await p(O):p;rt(_)?k=_:k=new Qt({...O,...p}),S.set({gl:k})}let z=S.raycaster;z||S.set({raycaster:z=new gt});const{params:ie,...V}=M||{};if(I.equ(V,z,Z)||U(z,{...V}),I.equ(ie,z.params,Z)||U(z,{params:{...z.params,...ie}}),!S.camera||S.camera===s&&!I.equ(s,R,Z)){s=R;const O=R?.isCamera,_=O?R:b?new Jt(0,0,0,0,.1,1e3):new Kt(75,0,.1,1e3);O||(_.position.z=5,R&&(U(_,R),_.manual||("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(_.manual=!0,_.updateProjectionMatrix())),!S.camera&&!(R!=null&&R.rotation)&&_.lookAt(0,0,0)),S.set({camera:_}),z.camera=_}if(!S.scene){let O;y!=null&&y.isScene?(O=y,pe(O,i,"",{})):(O=new bt,pe(O,i,"",{}),y&&U(O,y)),S.set({scene:O})}g&&!S.events.handlers&&S.set({events:g(i)});const W=fr(e,P);if(I.equ(W,S.size,Z)||S.setSize(W.width,W.height,W.top,W.left),j&&S.viewport.dpr!==jt(j)&&S.setDpr(j),S.frameloop!==T&&S.setFrameloop(T),S.onPointerMissed||S.set({onPointerMissed:G}),x&&!I.equ(x,S.performance,Z)&&S.set(O=>({performance:{...O.performance,...x}})),!S.xr){var q;const O=(D,ye)=>{const Ye=i.getState();Ye.frameloop!=="never"&&ct(D,!0,Ye,ye)},_=()=>{const D=i.getState();D.gl.xr.enabled=D.gl.xr.isPresenting,D.gl.xr.setAnimationLoop(D.gl.xr.isPresenting?O:null),D.gl.xr.isPresenting||ze(D)},N={connect(){const D=i.getState().gl;D.xr.addEventListener("sessionstart",_),D.xr.addEventListener("sessionend",_)},disconnect(){const D=i.getState().gl;D.xr.removeEventListener("sessionstart",_),D.xr.removeEventListener("sessionend",_)}};typeof((q=k.xr)==null?void 0:q.addEventListener)=="function"&&N.connect(),S.set({xr:N})}if(k.shadowMap){const O=k.shadowMap.enabled,_=k.shadowMap.type;if(k.shadowMap.enabled=!!d,I.boo(d))k.shadowMap.type=we;else if(I.str(d)){var ae;const N={basic:nn,percentage:tn,soft:we,variance:en};k.shadowMap.type=(ae=N[d])!=null?ae:we}else I.obj(d)&&Object.assign(k.shadowMap,d);(O!==k.shadowMap.enabled||_!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}return rn.enabled=!C,m||(k.outputColorSpace=w?on:yt,k.toneMapping=E?wt:sn),S.legacy!==C&&S.set(()=>({legacy:C})),S.linear!==w&&S.set(()=>({linear:w})),S.flat!==E&&S.set(()=>({flat:E})),p&&!I.fun(p)&&!rt(p)&&!I.equ(p,k,Z)&&U(k,p),c=h,m=!0,v(),this},render(u){return!m&&!f&&this.configure(),f.then(()=>{he.updateContainer(A.jsx(pr,{store:i,children:u,onCreated:c,rootElement:e}),l,null,()=>{})}),i},unmount(){At(e)}}}function pr({store:e,children:t,onCreated:n,rootElement:r}){return se(()=>{const o=e.getState();o.set(i=>({internal:{...i.internal,active:!0}})),n&&n(o),e.getState().events.connected||o.events.connect==null||o.events.connect(r)},[]),A.jsx(Ne.Provider,{value:e,children:t})}function At(e,t){const n=Y.get(e),r=n?.fiber;if(r){const o=n?.store.getState();o&&(o.internal.active=!1),he.updateContainer(null,r,null,()=>{o&&setTimeout(()=>{try{var i,l,c,s;o.events.disconnect==null||o.events.disconnect(),(i=o.gl)==null||(l=i.renderLists)==null||l.dispose==null||l.dispose(),(c=o.gl)==null||c.forceContextLoss==null||c.forceContextLoss(),(s=o.gl)!=null&&s.xr&&o.xr.disconnect(),Xn(o.scene),Y.delete(e)}catch{}},500)})}}function mr(e,t,n){return A.jsx(vr,{children:e,container:t,state:n})}function vr({state:e={},children:t,container:n}){const{events:r,size:o,...i}=e,l=qe(),[c]=a.useState(()=>new gt),[s]=a.useState(()=>new Pt),m=Ge((u,v)=>{let p;if(v.camera&&o){const P=v.camera;p=u.viewport.getCurrentViewport(P,new B,o),P!==u.camera&&St(P,o)}return{...u,...v,scene:n,raycaster:c,pointer:s,mouse:s,previousRoot:l,events:{...u.events,...v.events,...r},size:{...u.size,...o},viewport:{...u.viewport,...p},setEvents:P=>v.set(y=>({...y,events:{...y.events,...P}}))}}),f=a.useMemo(()=>{const u=ht((p,P)=>({...i,set:p,get:P})),v=p=>u.setState(P=>m.current(p,P));return v(l.getState()),l.subscribe(v),u},[l,n]);return A.jsx(A.Fragment,{children:he.createPortal(A.jsx(Ne.Provider,{value:f,children:t}),f,null)})}const hr=new Set,gr=new Set,br=new Set;function xe(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function re(e,t){switch(e){case"before":return xe(hr,t);case"after":return xe(gr,t);case"tail":return xe(br,t)}}let je,Me;function De(e,t,n){let r=t.clock.getDelta();t.frameloop==="never"&&typeof e=="number"&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),je=t.internal.subscribers;for(let o=0;o<je.length;o++)Me=je[o],Me.ref.current(Me.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}let ge=!1,Le=!1,Se,at,Q;function _t(e){at=requestAnimationFrame(_t),ge=!0,Se=0,re("before",e),Le=!0;for(const n of Y.values()){var t;Q=n.store.getState(),Q.internal.active&&(Q.frameloop==="always"||Q.internal.frames>0)&&!((t=Q.gl.xr)!=null&&t.isPresenting)&&(Se+=De(e,Q))}if(Le=!1,re("after",e),Se===0)return re("tail",e),ge=!1,cancelAnimationFrame(at)}function ze(e,t=1){var n;if(!e)return Y.forEach(r=>ze(r.store.getState(),t));(n=e.gl.xr)!=null&&n.isPresenting||!e.internal.active||e.frameloop==="never"||(t>1?e.internal.frames=Math.min(60,e.internal.frames+t):Le?e.internal.frames=2:e.internal.frames=1,ge||(ge=!0,requestAnimationFrame(_t)))}function ct(e,t=!0,n,r){if(t&&re("before",e),n)De(e,n,r);else for(const o of Y.values())De(e,o.store.getState());t&&re("after",e)}const Re={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function yr(e){const{handlePointer:t}=Jn(e);return{priority:1,enabled:!0,compute(n,r,o){r.pointer.set(n.offsetX/r.size.width*2-1,-(n.offsetY/r.size.height)*2+1),r.raycaster.setFromCamera(r.pointer,r.camera)},connected:void 0,handlers:Object.keys(Re).reduce((n,r)=>({...n,[r]:t(r)}),{}),update:()=>{var n;const{events:r,internal:o}=e.getState();(n=o.lastEvent)!=null&&n.current&&r.handlers&&r.handlers.onPointerMove(o.lastEvent.current)},connect:n=>{const{set:r,events:o}=e.getState();if(o.disconnect==null||o.disconnect(),r(i=>({events:{...i.events,connected:n}})),o.handlers)for(const i in o.handlers){const l=o.handlers[i],[c,s]=Re[i];n.addEventListener(c,l,{passive:s})}},disconnect:()=>{const{set:n,events:r}=e.getState();if(r.connected){if(r.handlers)for(const o in r.handlers){const i=r.handlers[o],[l]=Re[o];r.connected.removeEventListener(l,i)}n(o=>({events:{...o.events,connected:void 0}}))}}}}function wr({ref:e,children:t,fallback:n,resize:r,style:o,gl:i,events:l=yr,eventSource:c,eventPrefix:s,shadows:m,linear:f,flat:u,legacy:v,orthographic:p,frameloop:P,dpr:y,performance:g,raycaster:h,camera:d,scene:w,onPointerMissed:E,onCreated:C,...b}){a.useMemo(()=>Ue(un),[]);const T=Gn(),[j,x]=$t({scroll:!0,debounce:{scroll:50,resize:0},...r}),M=a.useRef(null),R=a.useRef(null);a.useImperativeHandle(e,()=>M.current);const G=Ge(E),[S,k]=a.useState(!1),[z,ie]=a.useState(!1);if(S)throw S;if(z)throw z;const V=a.useRef(null);se(()=>{const q=M.current;if(x.width>0&&x.height>0&&q){V.current||(V.current=dr(q));async function ae(){await V.current.configure({gl:i,scene:w,events:l,shadows:m,linear:f,flat:u,legacy:v,orthographic:p,frameloop:P,dpr:y,performance:g,raycaster:h,camera:d,size:x,onPointerMissed:(...O)=>G.current==null?void 0:G.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(c?Hn(c)?c.current:c:R.current),s&&O.setEvents({compute:(_,N)=>{const D=_[s+"X"],ye=_[s+"Y"];N.pointer.set(D/N.size.width*2-1,-(ye/N.size.height)*2+1),N.raycaster.setFromCamera(N.pointer,N.camera)}}),C?.(O)}}),V.current.render(A.jsx(T,{children:A.jsx(qn,{set:ie,children:A.jsx(a.Suspense,{fallback:A.jsx(Nn,{set:k}),children:t??null})})}))}ae()}}),a.useEffect(()=>{const q=M.current;if(q)return()=>At(q)},[]);const W=c?"none":"auto";return A.jsx("div",{ref:R,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...o},...b,children:A.jsx("div",{ref:j,style:{width:"100%",height:"100%"},children:A.jsx("canvas",{ref:M,style:{display:"block"},children:n})})})}function zr(e){return A.jsx(Yt,{children:A.jsx(wr,{...e})})}const Ve=a.createContext(null),lt=e=>(e.getAttributes()&2)===2,Hr=a.memo(a.forwardRef(({children:e,camera:t,scene:n,resolutionScale:r,enabled:o=!0,renderPriority:i=1,autoClear:l=!0,depthBuffer:c,enableNormalPass:s,stencilBuffer:m,multisampling:f=8,frameBufferType:u=Ct},v)=>{const{gl:p,scene:P,camera:y,size:g}=F(),h=n||P,d=t||y,[w,E,C]=a.useMemo(()=>{const j=new vn(p,{depthBuffer:c,stencilBuffer:m,multisampling:f,frameBufferType:u});j.addPass(new hn(h,d));let x=null,M=null;return s&&(M=new gn(h,d),M.enabled=!1,j.addPass(M),r!==void 0&&(x=new bn({normalBuffer:M.texture,resolutionScale:r}),x.enabled=!1,j.addPass(x))),[j,M,x]},[d,p,c,m,f,u,h,s,r]);a.useEffect(()=>w?.setSize(g.width,g.height),[w,g]),ne((j,x)=>{if(o){const M=p.autoClear;p.autoClear=l,m&&!l&&p.clearStencil(),w.render(x),p.autoClear=M}},o?i:0);const b=a.useRef(null);a.useLayoutEffect(()=>{const j=[],x=b.current.__r3f;if(x&&w){const M=x.children;for(let R=0;R<M.length;R++){const G=M[R].object;if(G instanceof Ze){const S=[G];if(!lt(G)){let z=null;for(;(z=M[R+1]?.object)instanceof Ze&&!lt(z);)S.push(z),R++}const k=new yn(d,...S);j.push(k)}else G instanceof wn&&j.push(G)}for(const R of j)w?.addPass(R);E&&(E.enabled=!0),C&&(C.enabled=!0)}return()=>{for(const M of j)w?.removePass(M);E&&(E.enabled=!1),C&&(C.enabled=!1)}},[w,e,d,E,C]),a.useEffect(()=>{const j=p.toneMapping;return p.toneMapping=wt,()=>{p.toneMapping=j}},[p]);const T=a.useMemo(()=>({composer:w,normalPass:E,downSamplingPass:C,resolutionScale:r,camera:d,scene:h}),[w,E,C,r,d,h]);return a.useImperativeHandle(v,()=>w,[w]),A.jsx(Ve.Provider,{value:T,children:A.jsx("group",{ref:b,children:e})})}));let Pr=0;const ut=new WeakMap,Dt=(e,t)=>function({blendFunction:n=t?.blendFunction,opacity:r=t?.opacity,...o}){let i=ut.get(e);if(!i){const s=`@react-three/postprocessing/${e.name}-${Pr++}`;Ue({[s]:e}),ut.set(e,i=s)}const l=F(s=>s.camera),c=Zt.useMemo(()=>[...t?.args??[],...o.args??[{...t,...o}]],[JSON.stringify(o)]);return A.jsx(i,{camera:l,"blendMode-blendFunction":n,"blendMode-opacity-value":r,...o,args:c})},Br=a.forwardRef(function({blendFunction:e,worldFocusDistance:t,worldFocusRange:n,focusDistance:r,focusRange:o,focalLength:i,bokehScale:l,resolutionScale:c,resolutionX:s,resolutionY:m,width:f,height:u,target:v,depthTexture:p,...P},y){const{camera:g}=a.useContext(Ve),h=v!=null,d=a.useMemo(()=>{const w=new dn(g,{blendFunction:e,worldFocusDistance:t,worldFocusRange:n,focusDistance:r,focusRange:o,focalLength:i,bokehScale:l,resolutionScale:c,resolutionX:s,resolutionY:m,width:f,height:u});h&&(w.target=new B),p&&w.setDepthTexture(p.texture,p.packing);const E=w.maskPass;return E.maskFunction=pn.MULTIPLY_RGB_SET_ALPHA,w},[g,e,t,n,r,o,i,l,c,s,m,f,u,h,p]);return a.useEffect(()=>()=>{d.dispose()},[d]),A.jsx("primitive",{...P,ref:y,object:d,target:v})}),Gr=a.forwardRef(function(e,t){const{camera:n,normalPass:r,downSamplingPass:o,resolutionScale:i}=a.useContext(Ve),l=a.useMemo(()=>r===null&&o===null?(console.error("Please enable the NormalPass in the EffectComposer in order to use SSAO."),{}):new fn(n,r&&!o?r.texture:null,{blendFunction:21,samples:30,rings:4,distanceThreshold:1,distanceFalloff:0,rangeThreshold:.5,rangeFalloff:.1,luminanceInfluence:.9,radius:20,bias:.5,intensity:1,color:void 0,normalDepthBuffer:o?o.texture:null,resolutionScale:i??1,depthAwareUpsampling:!0,...e}),[n,o,r,i]);return A.jsx("primitive",{ref:t,object:l,dispose:null})}),Nr=Dt(Pn),qr=Dt(mn);function L(){return L=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},L.apply(null,arguments)}const Ur=a.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:n="middle",font:r,fontSize:o=1,children:i,characters:l,onSync:c,...s},m)=>{const f=F(({invalidate:P})=>P),[u]=a.useState(()=>new Cn),[v,p]=a.useMemo(()=>{const P=[];let y="";return a.Children.forEach(i,g=>{typeof g=="string"||typeof g=="number"?y+=g:P.push(g)}),[P,y]},[i]);return vt(()=>new Promise(P=>En({font:r,characters:l},P)),["troika-text",r,l]),a.useLayoutEffect(()=>void u.sync(()=>{f(),c&&c(u)})),a.useEffect(()=>()=>u.dispose(),[u]),a.createElement("primitive",L({object:u,ref:m,font:r,text:p,anchorX:t,anchorY:n,fontSize:o,sdfGlyphSize:e},s),v)});function Cr(e,t,n,r){var o;return o=class extends xn{constructor(i){super({vertexShader:t,fragmentShader:n,...i});for(const l in e)this.uniforms[l]=new jn(e[l]),Object.defineProperty(this,l,{get(){return this.uniforms[l].value},set(c){this.uniforms[l].value=c}});this.uniforms=Mn.clone(this.uniforms)}},o.key=Sn.generateUUID(),o}const Te=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Lt(e,t){const n=F(i=>i.gl),r=X(He,Te(e)?Object.values(e):e);return a.useLayoutEffect(()=>{t?.(r)},[t]),a.useEffect(()=>{if("initTexture"in n){let i=[];Array.isArray(r)?i=r:r instanceof Qe?i=[r]:Te(r)&&(i=Object.values(r)),i.forEach(l=>{l instanceof Qe&&n.initTexture(l)})}},[n,r]),a.useMemo(()=>{if(Te(e)){const i={};let l=0;for(const c in e)i[c]=r[l++];return i}else return r},[e,r])}Lt.preload=e=>X.preload(He,e);Lt.clear=e=>X.clear(He,e);const Er=()=>parseInt(Rn.replace(/\D+/g,"")),xr=Er();let ue=null,zt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Ht(e=!0,t=!0,n){return r=>{n&&n(r),e&&(ue||(ue=new Tn),ue.setDecoderPath(typeof e=="string"?e:zt),r.setDRACOLoader(ue)),t&&r.setMeshoptDecoder(typeof Pe=="function"?Pe():Pe)}}const We=(e,t,n,r)=>X(Be,e,Ht(t,n,r));We.preload=(e,t,n,r)=>X.preload(Be,e,Ht(t,n,r));We.clear=e=>X.clear(Be,e);We.setDecoderPath=e=>{zt=e};function jr(e,t,n){const r=F(p=>p.size),o=F(p=>p.viewport),i=typeof e=="number"?e:r.width*o.dpr,l=r.height*o.dpr,c=(typeof e=="number"?n:e)||{},{samples:s=0,depth:m,...f}=c,u=m??c.depthBuffer,v=a.useMemo(()=>{const p=new On(i,l,{minFilter:Je,magFilter:Je,type:Ct,...f});return u&&(p.depthTexture=new In(i,l,Fn)),p.samples=s,p},[]);return a.useLayoutEffect(()=>{v.setSize(i,l),s&&(v.samples=s)},[s,v,i,l]),a.useEffect(()=>()=>v.dispose(),[]),v}const Mr=e=>typeof e=="function",Sr=a.forwardRef(({envMap:e,resolution:t=256,frames:n=1/0,children:r,makeDefault:o,...i},l)=>{const c=F(({set:g})=>g),s=F(({camera:g})=>g),m=F(({size:g})=>g),f=a.useRef(null);a.useImperativeHandle(l,()=>f.current,[]);const u=a.useRef(null),v=jr(t);a.useLayoutEffect(()=>{i.manual||f.current.updateProjectionMatrix()},[m,i]),a.useLayoutEffect(()=>{f.current.updateProjectionMatrix()}),a.useLayoutEffect(()=>{if(o){const g=s;return c(()=>({camera:f.current})),()=>c(()=>({camera:g}))}},[f,o,c]);let p=0,P=null;const y=Mr(r);return ne(g=>{y&&(n===1/0||p<n)&&(u.current.visible=!1,g.gl.setRenderTarget(v),P=g.scene.background,e&&(g.scene.background=e),g.gl.render(g.scene,f.current),g.scene.background=P,g.gl.setRenderTarget(null),u.current.visible=!0,p++)}),a.createElement(a.Fragment,null,a.createElement("orthographicCamera",L({left:m.width/-2,right:m.width/2,top:m.height/2,bottom:m.height/-2,ref:f},i),!y&&r),a.createElement("group",{ref:u},y&&r(v.texture)))}),Xr=a.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:r,enableDamping:o=!0,keyEvents:i=!1,onChange:l,onStart:c,onEnd:s,...m},f)=>{const u=F(b=>b.invalidate),v=F(b=>b.camera),p=F(b=>b.gl),P=F(b=>b.events),y=F(b=>b.setEvents),g=F(b=>b.set),h=F(b=>b.get),d=F(b=>b.performance),w=t||v,E=r||P.connected||p.domElement,C=a.useMemo(()=>new kn(w),[w]);return ne(()=>{C.enabled&&C.update()},-1),a.useEffect(()=>(i&&C.connect(i===!0?E:i),C.connect(E),()=>void C.dispose()),[i,E,n,C,u]),a.useEffect(()=>{const b=x=>{u(),n&&d.regress(),l&&l(x)},T=x=>{c&&c(x)},j=x=>{s&&s(x)};return C.addEventListener("change",b),C.addEventListener("start",T),C.addEventListener("end",j),()=>{C.removeEventListener("start",T),C.removeEventListener("end",j),C.removeEventListener("change",b)}},[l,c,s,C,u,y]),a.useEffect(()=>{if(e){const b=h().controls;return g({controls:C}),()=>g({controls:b})}},[e,C]),a.createElement("primitive",L({ref:f,object:C,enableDamping:o},m))});function Rr({defaultScene:e,defaultCamera:t,renderPriority:n=1}){const{gl:r,scene:o,camera:i}=F();let l;return ne(()=>{l=r.autoClear,n===1&&(r.autoClear=!0,r.render(e,t)),r.autoClear=!1,r.clearDepth(),r.render(o,i),r.autoClear=l},n),a.createElement("group",{onPointerOver:()=>null})}function Tr({children:e,renderPriority:t=1}){const{scene:n,camera:r}=F(),[o]=a.useState(()=>new bt);return a.createElement(a.Fragment,null,mr(a.createElement(a.Fragment,null,e,a.createElement(Rr,{defaultScene:n,defaultCamera:r,renderPriority:t})),o,{events:{priority:t+1}}))}const Bt=a.createContext({}),Or=()=>a.useContext(Bt),Ir=2*Math.PI,Oe=new An,ft=new _n,[J,Ie]=[new Ke,new Ke],dt=new B,pt=new B,Fr=e=>"minPolarAngle"in e,mt=e=>"getTarget"in e,Vr=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:n=1,onUpdate:r,onTarget:o,children:i})=>{const l=F(b=>b.size),c=F(b=>b.camera),s=F(b=>b.controls),m=F(b=>b.invalidate),f=a.useRef(null),u=a.useRef(null),v=a.useRef(!1),p=a.useRef(0),P=a.useRef(new B(0,0,0)),y=a.useRef(new B(0,0,0));a.useEffect(()=>{y.current.copy(c.up),Oe.up.copy(c.up)},[c]);const g=a.useCallback(b=>{v.current=!0,(s||o)&&(P.current=o?.()||(mt(s)?s.getTarget(P.current):s?.target)),p.current=c.position.distanceTo(dt),J.copy(c.quaternion),pt.copy(b).multiplyScalar(p.current).add(dt),Oe.lookAt(pt),Ie.copy(Oe.quaternion),m()},[s,c,o,m]);ne((b,T)=>{if(u.current&&f.current){var j;if(v.current)if(J.angleTo(Ie)<.01)v.current=!1,Fr(s)&&c.up.copy(y.current);else{const x=T*Ir;J.rotateTowards(Ie,x),c.position.set(0,0,1).applyQuaternion(J).multiplyScalar(p.current).add(P.current),c.up.set(0,1,0).applyQuaternion(J).normalize(),c.quaternion.copy(J),mt(s)&&s.setPosition(c.position.x,c.position.y,c.position.z),r?r():s&&s.update(T),m()}ft.copy(c.matrix).invert(),(j=f.current)==null||j.quaternion.setFromRotationMatrix(ft)}});const h=a.useMemo(()=>({tweenCamera:g}),[g]),[d,w]=t,E=e.endsWith("-center")?0:e.endsWith("-left")?-l.width/2+d:l.width/2-d,C=e.startsWith("center-")?0:e.startsWith("top-")?l.height/2-w:-l.height/2+w;return a.createElement(Tr,{renderPriority:n},a.createElement(Bt.Provider,{value:h},a.createElement(Sr,{makeDefault:!0,ref:u,position:[0,0,200]}),a.createElement("group",{ref:f,position:[E,C,0]},i)))};function Fe({scale:e=[.8,.05,.05],color:t,rotation:n}){return a.createElement("group",{rotation:n},a.createElement("mesh",{position:[.4,0,0]},a.createElement("boxGeometry",{args:e}),a.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function K({onClick:e,font:t,disabled:n,arcStyle:r,label:o,labelColor:i,axisHeadScale:l=1,...c}){const s=F(y=>y.gl),m=a.useMemo(()=>{const y=document.createElement("canvas");y.width=64,y.height=64;const g=y.getContext("2d");return g.beginPath(),g.arc(32,32,16,0,2*Math.PI),g.closePath(),g.fillStyle=r,g.fill(),o&&(g.font=t,g.textAlign="center",g.fillStyle=i,g.fillText(o,32,41)),new Dn(y)},[r,o,i,t]),[f,u]=a.useState(!1),v=(o?1:.75)*(f?1.2:1)*l,p=y=>{y.stopPropagation(),u(!0)},P=y=>{y.stopPropagation(),u(!1)};return a.createElement("sprite",L({scale:v,onPointerOver:n?void 0:p,onPointerOut:n?void 0:e||P},c),a.createElement("spriteMaterial",{map:m,"map-anisotropy":s.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:o?1:.75,toneMapped:!1}))}const Wr=({hideNegativeAxes:e,hideAxisHeads:t,disabled:n,font:r="18px Inter var, Arial, sans-serif",axisColors:o=["#ff2060","#20df80","#2080ff"],axisHeadScale:i=1,axisScale:l,labels:c=["X","Y","Z"],labelColor:s="#000",onClick:m,...f})=>{const[u,v,p]=o,{tweenCamera:P}=Or(),y={font:r,disabled:n,labelColor:s,onClick:m,axisHeadScale:i,onPointerDown:n?void 0:g=>{P(g.object.position),g.stopPropagation()}};return a.createElement("group",L({scale:40},f),a.createElement(Fe,{color:u,rotation:[0,0,0],scale:l}),a.createElement(Fe,{color:v,rotation:[0,0,Math.PI/2],scale:l}),a.createElement(Fe,{color:p,rotation:[0,-Math.PI/2,0],scale:l}),!t&&a.createElement(a.Fragment,null,a.createElement(K,L({arcStyle:u,position:[1,0,0],label:c[0]},y)),a.createElement(K,L({arcStyle:v,position:[0,1,0],label:c[1]},y)),a.createElement(K,L({arcStyle:p,position:[0,0,1],label:c[2]},y)),!e&&a.createElement(a.Fragment,null,a.createElement(K,L({arcStyle:u,position:[-1,0,0]},y)),a.createElement(K,L({arcStyle:v,position:[0,-1,0]},y)),a.createElement(K,L({arcStyle:p,position:[0,0,-1]},y)))))},kr=Cr({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new ke,sectionColor:new ke,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new B,worldPlanePosition:new B},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${xr>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),Yr=a.forwardRef(({args:e,cellColor:t="#000000",sectionColor:n="#2080ff",cellSize:r=.5,sectionSize:o=1,followCamera:i=!1,infiniteGrid:l=!1,fadeDistance:c=100,fadeStrength:s=1,fadeFrom:m=1,cellThickness:f=.5,sectionThickness:u=1,side:v=zn,...p},P)=>{Ue({GridMaterial:kr});const y=a.useRef(null);a.useImperativeHandle(P,()=>y.current,[]);const g=new Ln,h=new B(0,1,0),d=new B(0,0,0);ne(C=>{g.setFromNormalAndCoplanarPoint(h,d).applyMatrix4(y.current.matrixWorld);const b=y.current.material,T=b.uniforms.worldCamProjPosition,j=b.uniforms.worldPlanePosition;g.projectPoint(C.camera.position,T.value),j.value.set(0,0,0).applyMatrix4(y.current.matrixWorld)});const w={cellSize:r,sectionSize:o,cellColor:t,sectionColor:n,cellThickness:f,sectionThickness:u},E={fadeDistance:c,fadeStrength:s,fadeFrom:m,infiniteGrid:l,followCamera:i};return a.createElement("mesh",L({ref:y,frustumCulled:!1},p),a.createElement("gridMaterial",L({transparent:!0,"extensions-derivatives":!0,side:v},w,E)),a.createElement("planeGeometry",{args:e}))});function Ar(e,t){const n=e+"Geometry";return a.forwardRef(({args:r,children:o,...i},l)=>{const c=a.useRef(null);return a.useImperativeHandle(l,()=>c.current),a.useLayoutEffect(()=>void t?.(c.current)),a.createElement("mesh",L({ref:c},i),a.createElement(n,{attach:"geometry",args:r}),o)})}const $r=Ar("box");export{$r as B,zr as C,Yr as G,Gr as I,Nr as L,qr as N,Xr as O,Ur as T,Lt as a,We as b,F as c,Br as d,Vr as e,Wr as f,Hr as g,ne as u};
